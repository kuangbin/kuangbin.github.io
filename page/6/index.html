<!DOCTYPE html>












  


<html class="theme-next pisces use-motion" lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2"/>
<meta name="theme-color" content="#222">






  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-flash.min.css?v=1.0.2" rel="stylesheet">







<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=6.3.0" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.3.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.3.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.3.0">


  <link rel="mask-icon" href="/images/logo.svg?v=6.3.0" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '6.3.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":false},
    fancybox: true,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta property="og:type" content="website">
<meta property="og:title" content="kuangbin的博客">
<meta property="og:url" content="http://kuangbin.github.io/page/6/index.html">
<meta property="og:site_name" content="kuangbin的博客">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="kuangbin的博客">



  <link rel="alternate" href="/atom.xml" title="kuangbin的博客" type="application/atom+xml" />




  <link rel="canonical" href="http://kuangbin.github.io/page/6/"/>



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>kuangbin的博客</title>
  




<script async src="https://www.googletagmanager.com/gtag/js?id=UA-123329699-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-123329699-1');
</script>






  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>
	
	<a href="https://github.com/kuangbin"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_green_007200.png" alt="Fork me on GitHub"></a>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">kuangbin的博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">
    <a href="/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-home"></i> <br />首页</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-about">
    <a href="/about/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-user"></i> <br />关于</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">
    <a href="/tags/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />标签</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">
    <a href="/categories/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-th"></i> <br />分类</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">
    <a href="/archives/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />归档</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-catalogue">
    <a href="/catalogue/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br />目录</a>
  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />搜索</a>
        </li>
      
    </ul>
  

  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://kuangbin.github.io/2014/10/05/zoj3816/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="kuangbin">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/blogLogo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="kuangbin的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2014/10/05/zoj3816/" itemprop="url">
                  ZOJ 3816 Generalized Palindromic Number （数位DP+二分）
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2014-10-05 10:01:07" itemprop="dateCreated datePublished" datetime="2014-10-05T10:01:07+08:00">2014-10-05</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2018-07-29 13:43:28" itemprop="dateModified" datetime="2018-07-29T13:43:28+08:00">2018-07-29</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Online-Judge/" itemprop="url" rel="index"><span itemprop="name">Online Judge</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Online-Judge/ZJU/" itemprop="url" rel="index"><span itemprop="name">ZJU</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Online-Judge/ZJU/数位DP/" itemprop="url" rel="index"><span itemprop="name">数位DP</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Online-Judge/ZJU/数位DP/算法/" itemprop="url" rel="index"><span itemprop="name">算法</span></a></span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2014/10/05/zoj3816/#comments" itemprop="discussionUrl">
                
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2014/10/05/zoj3816/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><a href="http://acm.zju.edu.cn/onlinejudge/showProblem.do?problemId=5348" target="_blank" rel="noopener">ZOJ3816</a>   这题方法很多，暴力的做法我还没看懂， 只会用数位DP搞。 二分区间，然后数位DP求个数就可以了。</p>
<p>Generalized Palindromic Number</p>
<hr>
<p>Time Limit: 2 Seconds      Memory Limit: 65536 KB</p>
<hr>
<p>A number that will be the same when it is written forwards or backwards is known as a palindromic number. For example, 1234321 is a palindromic number. We call a number <strong>generalized palindromic number</strong>, if after merging all the consecutive same digits, the resulting number is a palindromic number. For example, 122111 is a generalized palindromic number. Because after merging, 122111 turns into 121 which is a palindromic number. Now you are given a positive integer N, please find the largest generalized palindromic number less than N.</p>
<h4 id="Input"><a href="#Input" class="headerlink" title="Input"></a>Input</h4><p>There are multiple test cases. The first line of input contains an integer T (about 5000) indicating the number of test cases. For each test case: There is only one integer N (1 &lt;= N &lt;= 1018).</p>
<h4 id="Output"><a href="#Output" class="headerlink" title="Output"></a>Output</h4><p>For each test case, output the largest generalized palindromic number less than N.</p>
<h4 id="Sample-Input"><a href="#Sample-Input" class="headerlink" title="Sample Input"></a>Sample Input</h4><p>4<br>12<br>123<br>1224<br>1122</p>
<h4 id="Sample-Output"><a href="#Sample-Output" class="headerlink" title="Sample Output"></a>Sample Output</h4><p>11<br>121<br>1221<br>1121</p>
<hr>
<p>Author: <strong>LIN, Xi</strong> Source: <strong>The 2014 ACM-ICPC Asia Mudanjiang Regional First Round</strong>    </p>
<p>#include &lt;stdio.h&gt;</p>
<p>#include <algorithm></algorithm></p>
<p>#include <iostream></iostream></p>
<p>#include <queue></queue></p>
<p>#include <set></set></p>
<p>#include &lt;string.h&gt;</p>
<p>#include <map></map></p>
<p>#include <vector></vector></p>
<p>#include <string></string></p>
<p>#include &lt;math.h&gt;<br>using namespace std;<br>long long dp[20][20][20];<br>int bit[30];<br>int num[30];<br>long long dfs(int pos,int now,int aim,bool limit){<br>    if(pos &lt; 0)return now == aim;<br>    if(!limit &amp;&amp; dp[pos][now][aim] != -1)<br>        return dp[pos][now][aim];<br>    int end = limit ? bit[pos] : 9;<br>    long long ans = 0;<br>    for(int i = 0;i &lt;= end;i++){<br>        if(now == 0){<br>            if(i == 0){<br>                ans += dfs(pos-1,now,aim,limit &amp;&amp; (i == end));<br>            }<br>            else {<br>                num[now] = i;<br>                if(now &lt; aim)ans += dfs(pos-1,now+1,aim,limit &amp;&amp; (i == end));<br>            }<br>        }<br>        else {<br>            if(i == num[now-1])ans += dfs(pos-1,now,aim,limit &amp;&amp; (i == end));<br>            else {<br>                num[now] = i;<br>                if(now &lt; (aim+1)/2){<br>                    if(now &lt; aim)ans += dfs(pos-1,now+1,aim,limit &amp;&amp; (i == end));<br>                }<br>                else {<br>                    if(i != num[aim-1-now])continue;<br>                    if(now &lt; aim)ans += dfs(pos-1,now+1,aim,limit &amp;&amp; (i == end));<br>                }<br>            }<br>        }<br>    }<br>    if(!limit)dp[pos][now][aim] = ans;<br>    return ans;<br>}<br>long long calc(long long n){<br>    int pos = 0;<br>    do{<br>        bit[pos++] = n%10;<br>        n /= 10;<br>    }while(n);<br>    long long ans = 0;<br>    for(int i = 1;i &lt;= pos;i++)<br>        ans += dfs(pos-1,0,i,1);<br>    return ans;<br>}</p>
<p>int main()<br>{<br>    //freopen(“in.txt”,”r”,stdin);<br>    //freopen(“out.txt”,”w”,stdout);<br>    int T;<br>    scanf(“%d”,&amp;T);<br>    long long n;<br>    memset(dp,-1,sizeof(dp));<br>    while(T–){<br>        scanf(“%lld”,&amp;n);<br>        n–;<br>        long long tmp = calc(n);<br>        long long l = 0, r = n;<br>        long long ans = 0;<br>        while(l &lt;= r){<br>            long long mid = (l+r)/2;<br>            if(calc(mid) &gt;= tmp){<br>                ans = mid;<br>                r = mid-1;<br>            }<br>            else l = mid+1;<br>        }<br>        printf(“%lld\n”,ans);<br>    }<br>    return 0;<br>}</p>

          
        
      
    </div>

    

    
    
    
	
	<div>
		
	</div>
 
	<div>
      
	</div>

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://kuangbin.github.io/2014/10/05/zoj3818/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="kuangbin">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/blogLogo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="kuangbin的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2014/10/05/zoj3818/" itemprop="url">
                  ZOJ 3818 Pretty Poem （水题）
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2014-10-05 09:29:05" itemprop="dateCreated datePublished" datetime="2014-10-05T09:29:05+08:00">2014-10-05</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2018-07-29 13:43:28" itemprop="dateModified" datetime="2018-07-29T13:43:28+08:00">2018-07-29</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Online-Judge/" itemprop="url" rel="index"><span itemprop="name">Online Judge</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Online-Judge/ZJU/" itemprop="url" rel="index"><span itemprop="name">ZJU</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Online-Judge/ZJU/水题/" itemprop="url" rel="index"><span itemprop="name">水题</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Online-Judge/ZJU/水题/算法/" itemprop="url" rel="index"><span itemprop="name">算法</span></a></span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2014/10/05/zoj3818/#comments" itemprop="discussionUrl">
                
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2014/10/05/zoj3818/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><a href="http://acm.zju.edu.cn/onlinejudge/showProblem.do?problemId=5350" target="_blank" rel="noopener">ZOJ3818</a>   水题一个。 直接暴力搞。 就是需要注意A,B,C要是不同的。</p>
<p>Pretty Poem</p>
<hr>
<p>Time Limit: 2 Seconds      Memory Limit: 65536 KB</p>
<hr>
<p>Poetry is a form of literature that uses aesthetic and rhythmic qualities of language. There are many famous poets in the contemporary era. It is said that a few ACM-ICPC contestants can even write poetic code. Some poems has a strict rhyme scheme like “ABABA” or “ABABCAB”. For example, “niconiconi” is composed of a rhyme scheme “ABABA” with A = “ni” and B = “co”. More technically, we call a poem <strong>pretty</strong> if it can be decomposed into one of the following rhyme scheme: “ABABA” or “ABABCAB”. The symbol <strong>A</strong>, <strong>B</strong> and <strong>C</strong> are different continuous non-empty substrings of the poem. By the way, punctuation characters should be ignored when considering the rhyme scheme. You are given a line of poem, please determine whether it is pretty or not.</p>
<h4 id="Input"><a href="#Input" class="headerlink" title="Input"></a>Input</h4><p>There are multiple test cases. The first line of input contains an integer T indicating the number of test cases. For each test case: There is a line of poem S (1 &lt;= length(S) &lt;= 50). S will only contains alphabet characters or punctuation characters.</p>
<h4 id="Output"><a href="#Output" class="headerlink" title="Output"></a>Output</h4><p>For each test case, output “Yes” if the poem is pretty, or “No” if not.</p>
<h4 id="Sample-Input"><a href="#Sample-Input" class="headerlink" title="Sample Input"></a>Sample Input</h4><p>3<br>niconiconi~<br>pettan,pettan,tsurupettan<br>wafuwafu</p>
<h4 id="Sample-Output"><a href="#Sample-Output" class="headerlink" title="Sample Output"></a>Sample Output</h4><p>Yes<br>Yes<br>No</p>
<hr>
<p>Author: <strong>JIANG, Kai</strong> Source: <strong>The 2014 ACM-ICPC Asia Mudanjiang Regional First Round</strong>  </p>
<p>/* <strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong>***</strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong><br>Author        :kuangbin<br>Created Time  :2014/10/5 9:10:11<br>File Name     :ZOJ3818.cpp<br>************************************************ */</p>
<p>#include &lt;stdio.h&gt;</p>
<p>#include &lt;string.h&gt;</p>
<p>#include <iostream></iostream></p>
<p>#include <algorithm></algorithm></p>
<p>#include <vector></vector></p>
<p>#include <queue></queue></p>
<p>#include <set></set></p>
<p>#include <map></map></p>
<p>#include <string></string></p>
<p>#include &lt;math.h&gt;</p>
<p>#include &lt;stdlib.h&gt;</p>
<p>#include &lt;time.h&gt;<br>using namespace std;<br>bool check1(string str,string A,string B){<br>    if(A == B)return false;<br>    string tmp = A + B + A + B + A;<br>    return str == tmp;<br>}<br>bool check2(string str,string A,string B){<br>    if(A == B)return false;<br>    int len = str.length();<br>    int al = A.length();<br>    int bl = B.length();<br>    if(len &lt;= 3*(al+bl))return false;<br>    string tmp = string(str.begin(),str.begin()+al+bl);<br>    if(tmp != (A+B))return false;<br>    tmp = string(str.begin()+al+bl,str.begin()+al+bl+al+bl);<br>    if(tmp != (A+B))return false;<br>    tmp = string(str.begin()+al+bl+al+bl,str.end()-al-bl);<br>    if(tmp == A || tmp == B)return false;<br>    tmp = string(str.end()-al-bl,str.end());<br>    if(tmp != (A+B))return false;<br>    return true;<br>}<br>bool check(string str){<br>    int len = str.length();<br>    for(int i = 1;i &lt;= len;i++)<br>        for(int j = 1;j+i &lt;= len;j++)<br>            if(check1(str,string(str.begin(),str.begin()+i),string(str.begin()+i,str.begin()+i+j))<br>                  || check2(str,string(str.begin(),str.begin()+i),string(str.begin()+i,str.begin()+i+j)) )<br>                return true;<br>    return false;<br>}<br>char ss[100];<br>int main()<br>{<br>    //freopen(“in.txt”,”r”,stdin);<br>    //freopen(“out.txt”,”w”,stdout);<br>    string str;<br>    int T;<br>    scanf(“%d”,&amp;T);<br>    while(T–){<br>        scanf(“%s”,ss);<br>        int len = strlen(ss);<br>        str = “”;<br>        for(int i = 0;i &lt; len;i++)<br>            if( (ss[i] &gt;= ‘a’ &amp;&amp; ss[i] &lt;= ‘z’)<br>                    || (ss[i] &gt;= ‘A’ &amp;&amp; ss[i] &lt;= ‘Z’))<br>                str += ss[i];<br>        if(check(str))printf(“Yes\n”);<br>        else printf(“No\n”);<br>    }<br>    return 0;<br>}</p>

          
        
      
    </div>

    

    
    
    
	
	<div>
		
	</div>
 
	<div>
      
	</div>

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://kuangbin.github.io/2014/10/04/hdu3932/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="kuangbin">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/blogLogo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="kuangbin的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2014/10/04/hdu3932/" itemprop="url">
                  HDU 3932 Groundhog Build Home （随机算法）
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2014-10-04 22:52:41" itemprop="dateCreated datePublished" datetime="2014-10-04T22:52:41+08:00">2014-10-04</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2018-07-29 20:53:59" itemprop="dateModified" datetime="2018-07-29T20:53:59+08:00">2018-07-29</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Online-Judge/" itemprop="url" rel="index"><span itemprop="name">Online Judge</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/HDU/" itemprop="url" rel="index"><span itemprop="name">HDU</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/算法/" itemprop="url" rel="index"><span itemprop="name">算法</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/模拟退火/" itemprop="url" rel="index"><span itemprop="name">模拟退火</span></a></span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2014/10/04/hdu3932/#comments" itemprop="discussionUrl">
                
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2014/10/04/hdu3932/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><a href="http://acm.hdu.edu.cn/showproblem.php?pid=3932" target="_blank" rel="noopener">HDU3932</a>   随机大法乱搞！</p>
<h1 id="Groundhog-Build-Home"><a href="#Groundhog-Build-Home" class="headerlink" title="Groundhog Build Home"></a>Groundhog Build Home</h1><p><strong>Time Limit: 15000/5000 MS (Java/Others)    Memory Limit: 65536/65536 K (Java/Others) Total Submission(s): 1579    Accepted Submission(s): 686</strong></p>
<p>Problem Description</p>
<p>Groundhogs are good at digging holes, their home is a hole, usually a group of groundhogs will find a more suitable area for their activities and build their home at this area .xiaomi has grown up, can no longer live with its parents.so it needs to build its own home.xiaomi like to visit other family so much, at each visit it always start from the point of his own home.Xiaomi will visit all of the groundhogs’ home in this area(it will chose the linear distance between two homes).To save energy,xiaomi would like you to help it find where its home built,so that the longest distance between xiaomi’s home and the other groundhog’s home is minimum.</p>
<p>Input</p>
<p>The input consists of many test cases，ending of eof.Each test case begins with a line containing three integers X, Y, N separated by space.The numbers satisfy conditions: 1 &lt;= X,Y &lt;=10000, 1 &lt;= N&lt;= 1000. Groundhogs acivity at a rectangular area ,and X, Y is the two side of this rectangle, The number N stands for the number of holes.Then exactly N lines follow, each containing two integer numbers xi and yi (0 &lt;= xi &lt;= X, 0 &lt;= yi &lt;= Y) indicating the coordinates of one home.</p>
<p>Output</p>
<p>Print exactly two lines for each test case.The first line is the coordinate of xiaomi’s home which we help to find. The second line is he longest distance between xiaomi’s home and the other groundhog’s home.The output round to the nearest number with exactly one digit after the decimal point (0.05 rounds up to 0.1).</p>
<p>Sample Input</p>
<p>1000 50 1 10 10 1000 50 4 0 0 1 0 0 1 1 1</p>
<p>Sample Output</p>
<p>(10.0,10.0). 0.0 (0.5,0.5). 0.7</p>
<p>Source</p>
<p><a href="http://acm.hdu.edu.cn/search.php?field=problem&amp;key=2011+Multi-University+Training+Contest+10+-+Host+by+HRBEU&amp;source=1&amp;searchmode=source" target="_blank" rel="noopener">2011 Multi-University Training Contest 10 - Host by HRBEU</a></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;queue&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;set&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;map&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;math.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;time.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">10100</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">double</span> PI = <span class="built_in">acos</span>(<span class="number">-1.0</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Point</span>&#123;</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">double</span> x,y;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">input</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">"%lf%lf"</span>,&amp;x,&amp;y);</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">double</span> <span class="title">distance</span><span class="params">(Point b)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">sqrt</span>((x-b.x)(x-b.x)+(y-b.y)(y-b.y));</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;p[MAXN],tp[<span class="number">50</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">double</span> dist[<span class="number">50</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">calc</span><span class="params">(Point p0)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">double</span> ret = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; n;i++)</span><br><span class="line"></span><br><span class="line">		ret = max(ret,p[i].distance(p0));</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> ret;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//freopen("in.txt","r",stdin);</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//freopen("out.txt","w",stdout);</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">double</span> X,Y;</span><br><span class="line"></span><br><span class="line">	srand(time(<span class="literal">NULL</span>));</span><br><span class="line"></span><br><span class="line">	<span class="keyword">int</span> P = <span class="number">15</span>, L = <span class="number">30</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">while</span>(<span class="built_in">scanf</span>(<span class="string">"%lf%lf%d"</span>,&amp;X,&amp;Y,&amp;n) == <span class="number">3</span>)&#123;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; n;i++)p[i].input();</span><br><span class="line"></span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; P;i++)&#123;</span><br><span class="line"></span><br><span class="line">			tp[i].x = (rand()%<span class="number">1000</span>+<span class="number">1</span>)/<span class="number">1000.0</span>*X;</span><br><span class="line"></span><br><span class="line">			tp[i].y = (rand()%<span class="number">1000</span>+<span class="number">1</span>)/<span class="number">1000.0</span>*Y;</span><br><span class="line"></span><br><span class="line">			dist[i] = calc(tp[i]);</span><br><span class="line"></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">double</span> step = <span class="built_in">sqrt</span>(X*X + Y*Y)/<span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">while</span>(step &gt; <span class="number">1e-5</span>)&#123;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; P;i++)&#123;</span><br><span class="line"></span><br><span class="line">				Point cur, pre = tp[i];</span><br><span class="line"></span><br><span class="line">				<span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>;j &lt; L;j++)&#123;</span><br><span class="line"></span><br><span class="line">					<span class="keyword">double</span> angle = (rand()%<span class="number">1000</span>+<span class="number">1</span>)/<span class="number">1000.0</span>*<span class="number">2</span>*PI;</span><br><span class="line"></span><br><span class="line">					cur.x = pre.x + <span class="built_in">cos</span>(angle)*step;</span><br><span class="line"></span><br><span class="line">					cur.y = pre.y + <span class="built_in">sin</span>(angle)*step;</span><br><span class="line"></span><br><span class="line">					<span class="keyword">if</span>(cur.x &lt; <span class="number">0</span> || cur.x &gt; X || cur.y &lt; <span class="number">0</span> || cur.y &gt; Y)<span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">					<span class="keyword">double</span> tmp = calc(cur);</span><br><span class="line"></span><br><span class="line">					<span class="keyword">if</span>(tmp &lt;  dist[i])&#123;</span><br><span class="line"></span><br><span class="line">						tp[i] = cur;</span><br><span class="line"></span><br><span class="line">						dist[i] = tmp;</span><br><span class="line"></span><br><span class="line">					&#125;</span><br><span class="line"></span><br><span class="line">				&#125;</span><br><span class="line"></span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			step *= <span class="number">0.85</span>;</span><br><span class="line"></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">int</span> id;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">double</span> ans = <span class="number">1e20</span>;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; P;i++)</span><br><span class="line"></span><br><span class="line">			<span class="keyword">if</span>(dist[i] &lt; ans)&#123;</span><br><span class="line"></span><br><span class="line">				ans = dist[i];</span><br><span class="line"></span><br><span class="line">				id = i;</span><br><span class="line"></span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"(%.1lf,%.1lf).\n"</span>,tp[id].x,tp[id].y);</span><br><span class="line"></span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"%.1lf\n"</span>,dist[id]);</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    

    
    
    
	
	<div>
		
	</div>
 
	<div>
      
	</div>

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://kuangbin.github.io/2014/10/04/poj1379/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="kuangbin">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/blogLogo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="kuangbin的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2014/10/04/poj1379/" itemprop="url">
                  POJ 1379 Run Away （随机算法）
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2014-10-04 22:26:08" itemprop="dateCreated datePublished" datetime="2014-10-04T22:26:08+08:00">2014-10-04</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2018-07-29 13:43:28" itemprop="dateModified" datetime="2018-07-29T13:43:28+08:00">2018-07-29</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Online-Judge/" itemprop="url" rel="index"><span itemprop="name">Online Judge</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Online-Judge/POJ/" itemprop="url" rel="index"><span itemprop="name">POJ</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Online-Judge/POJ/模拟退火/" itemprop="url" rel="index"><span itemprop="name">模拟退火</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Online-Judge/POJ/模拟退火/算法/" itemprop="url" rel="index"><span itemprop="name">算法</span></a></span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2014/10/04/poj1379/#comments" itemprop="discussionUrl">
                
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2014/10/04/poj1379/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><a href="http://poj.org/problem?id=1379" target="_blank" rel="noopener">POJ1379</a>   地图中有N个陷阱，给出他们的坐标，求一个点，使得这个点到所有陷阱的最小距离最大。   随机搞，选几个候选集，然后类似模拟退火的步骤，缩小步长。</p>
<p>Run Away</p>
<p><strong>Time Limit:</strong> 3000MS</p>
<p><strong>Memory Limit:</strong> 65536K</p>
<p><strong>Total Submissions:</strong> 6348</p>
<p><strong>Accepted:</strong> 1951</p>
<p>Description</p>
<p>One of the traps we will encounter in the Pyramid is located in the Large Room. A lot of small holes are drilled into the floor. They look completely harmless at the first sight. But when activated, they start to throw out very hot java, uh … pardon, lava. Unfortunately, all known paths to the Center Room (where the Sarcophagus is) contain a trigger that activates the trap. The ACM were not able to avoid that. But they have carefully monitored the positions of all the holes. So it is important to find the place in the Large Room that has the maximal distance from all the holes. This place is the safest in the entire room and the archaeologist has to hide there.</p>
<p>Input</p>
<p>The input consists of T test cases. The number of them (T) is given on the first line of the input file. Each test case begins with a line containing three integers X, Y, M separated by space. The numbers satisfy conditions: 1 &lt;= X,Y &lt;=10000, 1 &lt;= M &lt;= 1000. The numbers X and Yindicate the dimensions of the Large Room which has a rectangular shape. The number M stands for the number of holes. Then exactly M lines follow, each containing two integer numbers Ui and Vi (0 &lt;= Ui &lt;= X, 0 &lt;= Vi &lt;= Y) indicating the coordinates of one hole. There may be several holes at the same position.</p>
<p>Output</p>
<p>Print exactly one line for each test case. The line should contain the sentence “The safest point is (P, Q).” where P and Qare the coordinates of the point in the room that has the maximum distance from the nearest hole, rounded to the nearest number with exactly one digit after the decimal point (0.05 rounds up to 0.1).</p>
<p>Sample Input</p>
<p>3<br>1000 50 1<br>10 10<br>100 100 4<br>10 10<br>10 90<br>90 10<br>90 90<br>3000 3000 4<br>1200 85<br>63 2500<br>2700 2650<br>2990 100</p>
<p>Sample Output</p>
<p>The safest point is (1000.0, 50.0).<br>The safest point is (50.0, 50.0).<br>The safest point is (1433.0, 1669.8).</p>
<p>Source</p>
<p><a href="http://poj.org/searchproblem?field=source&amp;key=Central+Europe+1999" target="_blank" rel="noopener">Central Europe 1999</a></p>
<pre><code>POJ上用C++交可过， 用G++的话，要把输出改为 %f   如果WA，多交几次可破。
</code></pre><p>/* <strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong>***</strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong><br>Author        :kuangbin<br>Created Time  :2014/10/4 21:49:13<br>File Name     :E:\2014ACM\专题学习\计算几何\模拟退火\POJ1379.cpp<br>************************************************ */</p>
<p>#include &lt;stdio.h&gt;</p>
<p>#include &lt;string.h&gt;</p>
<p>#include <iostream></iostream></p>
<p>#include <algorithm></algorithm></p>
<p>#include <vector></vector></p>
<p>#include <queue></queue></p>
<p>#include <set></set></p>
<p>#include <map></map></p>
<p>#include <string></string></p>
<p>#include &lt;math.h&gt;</p>
<p>#include &lt;stdlib.h&gt;</p>
<p>#include &lt;time.h&gt;<br>using namespace std;<br>const int MAXN = 10100;<br>const double PI = acos(-1.0);<br>struct Point{<br>    double x,y;<br>    void input(){<br>        scanf(“%lf%lf”,&amp;x,&amp;y);<br>    }<br>    double distance(Point b){<br>        return sqrt((x-b.x)<em>(x-b.x)+(y-b.y)</em>(y-b.y));<br>    }<br>}p[MAXN],tp[50];<br>double dist[50];<br>int n;<br>double calc(Point p0){<br>    double ret = 1e20;<br>    for(int i = 0;i &lt; n;i++)<br>        ret = min(ret,p[i].distance(p0));<br>    return ret;<br>}<br>int main()<br>{<br>    //freopen(“in.txt”,”r”,stdin);<br>    //freopen(“out.txt”,”w”,stdout);<br>    int T;<br>    double X,Y;<br>    scanf(“%d”,&amp;T);<br>    srand(time(NULL));<br>    int P = 15, L = 30;<br>    while(T–){<br>        scanf(“%lf%lf%d”,&amp;X,&amp;Y,&amp;n);<br>        for(int i = 0;i &lt; n;i++)p[i].input();<br>        for(int i = 0;i &lt; P;i++){<br>            tp[i].x = (rand()%1000+1)/1000.0<em>X;<br>            tp[i].y = (rand()%1000+1)/1000.0</em>Y;<br>            dist[i] = calc(tp[i]);<br>        }<br>        double step = sqrt(X*X + Y*Y)/2;<br>        while(step &gt; 1e-5){<br>            for(int i = 0;i &lt; P;i++){<br>                Point cur, pre = tp[i];<br>                for(int j = 0;j &lt; L;j++){<br>                    double angle = (rand()%1000+1)/1000.0*2*PI;<br>                    cur.x = pre.x + cos(angle)<em>step;<br>                    cur.y = pre.y + sin(angle)</em>step;<br>                    if(cur.x &lt; 0 || cur.x &gt; X || cur.y &lt; 0 || cur.y &gt; Y)continue;<br>                    double tmp = calc(cur);<br>                    if(tmp &gt;  dist[i]){<br>                        tp[i] = cur;<br>                        dist[i] = tmp;<br>                    }<br>                }<br>            }<br>            step *= 0.8;<br>        }<br>        int id;<br>        double ans = 0;<br>        for(int i = 0;i &lt; P;i++)<br>            if(dist[i] &gt; ans){<br>                ans = dist[i];<br>                id = i;<br>            }<br>        printf(“The safest point is (%.1lf, %.1lf).\n”,tp[id].x,tp[id].y);<br>    }<br>    return 0;<br>}</p>

          
        
      
    </div>

    

    
    
    
	
	<div>
		
	</div>
 
	<div>
      
	</div>

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://kuangbin.github.io/2014/10/03/zoj3817/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="kuangbin">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/blogLogo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="kuangbin的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2014/10/03/zoj3817/" itemprop="url">
                  ZOJ 3817 Chinese Knot （DP）
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2014-10-03 09:05:53" itemprop="dateCreated datePublished" datetime="2014-10-03T09:05:53+08:00">2014-10-03</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2018-07-29 13:43:28" itemprop="dateModified" datetime="2018-07-29T13:43:28+08:00">2018-07-29</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/DP/" itemprop="url" rel="index"><span itemprop="name">DP</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/DP/Online-Judge/" itemprop="url" rel="index"><span itemprop="name">Online Judge</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/DP/Online-Judge/ZJU/" itemprop="url" rel="index"><span itemprop="name">ZJU</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/DP/Online-Judge/ZJU/算法/" itemprop="url" rel="index"><span itemprop="name">算法</span></a></span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2014/10/03/zoj3817/#comments" itemprop="discussionUrl">
                
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2014/10/03/zoj3817/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><a href="http://acm.zju.edu.cn/onlinejudge/showProblem.do?problemId=5349" target="_blank" rel="noopener">ZOJ3817</a>   非常好的一个题。 想出来了就比较简单了。 题意比较清楚。 大致意思就是有4条链。 四条链的端点之间是可以跳过去的。 然后给了一个目标字符串，要输出得到目标字符串的一个路径。   因为链可以反向走，那么4条链可以变为8条链。 这样其实问题转化成8条链可以跳来跳去得到目标串。 如果只走一条链，那么直接hash进行判断输出。 如果转移了多条链，那么只需要记录现在在哪条链的终点。 然后进行转移。   需要输出路径，要记录一下。</p>
<p>Chinese Knot</p>
<hr>
<p>Time Limit: 2 Seconds      Memory Limit: 65536 KB      Special Judge</p>
<hr>
<p>Chinese knot is a decorative handicraft that began as a form of Chinese folk artifact in the <em>Tang</em> and <em>Song</em> Dynasty in China. It was later popularized in the <em>Ming</em>. Alice is learning Chinese knotting. To take the first step, she went to the store and bought a string. To her surprise, she found the string was composed of characters! Anyway, she made a simple Chinese knot. It consists of one knot with 4 loops:</p>
<p><a href="http://acm.zju.edu.cn/onlinejudge/showImage.do?name=walkonlogo_string_with_number.jpg" target="_blank" rel="noopener"><img src="http://acm.zju.edu.cn/onlinejudge/showImage.do?name=walkonlogo_string_with_number.jpg" alt=""></a></p>
<p>Look at the picture above. There are four loops connected at the center black knot. To make the image clear and neat, the characters on the string are shown as red and yellow points. As a Mid-Autumn Festival gift, Alice give this handcrafted Chinese knot to you. Then she asked you a question: You are given a target character sequence. Can you get the sequence by walking on the knot? “Walking on the knot” means:</p>
<ul>
<li>You can start at any point you want.</li>
<li>You can not start at or move to the black knot in the center.</li>
<li>Each step, you can only move to an adjacent point, except for the point you came from immediately.</li>
<li>The 8 points closely around the black knot are adjacent to each other. For example, in the picture above, they are the 8 yellow points adjacent to the black knot.</li>
<li>Your path should not contain three continuous points which are both one of the 8 points mentioned above.</li>
</ul>
<h4 id="Input"><a href="#Input" class="headerlink" title="Input"></a>Input</h4><p>There are multiple test cases. The first line of input contains an integer T indicating the number of test cases. For each test case: The first line contains two integers N and M (3 &lt;= N, M &lt;= 100000). The total length of string that Alice bought from store is 4 <em> N. Then followed by 4 lines, each line contains N lower case letters as a loop of the Chinese knot. These characters are indexed from 1 to 4 </em> N corresponding to the input order. The next line contains M lower case letters indicating the target character sequence.</p>
<h4 id="Output"><a href="#Output" class="headerlink" title="Output"></a>Output</h4><p>For each test case, output the M indexes of characters you visited. If there are multiple solutions, output any one. If there is no solution, output “No solution!” instead.</p>
<h4 id="Sample-Input"><a href="#Sample-Input" class="headerlink" title="Sample Input"></a>Sample Input</h4><p>2<br>3 3<br>abc<br>abc<br>abc<br>abc<br>baa<br>3 3<br>abc<br>abc<br>abc<br>abc<br>bab</p>
<h4 id="Sample-Output"><a href="#Sample-Output" class="headerlink" title="Sample Output"></a>Sample Output</h4><p>2 1 4<br>No solution!</p>
<h4 id="Hint"><a href="#Hint" class="headerlink" title="Hint"></a>Hint</h4><p>In the first case, we start at the second character of the first loop and stop at the first character of the second loop.</p>
<hr>
<p>Author: <strong>CHEN, Weijie</strong> Source: <strong>The 2014 ACM-ICPC Asia Mudanjiang Regional First Round</strong>     代码君：</p>
<p>/* <strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong>***</strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong><br>Author        :kuangbin<br>Created Time  :2014/10/3 8:16:55<br>File Name     :E:\2014ACM\2014网络赛\2014牡丹江\I.cpp<br>************************************************ */</p>
<p>#include &lt;stdio.h&gt;</p>
<p>#include &lt;string.h&gt;</p>
<p>#include <iostream></iostream></p>
<p>#include <algorithm></algorithm></p>
<p>#include <vector></vector></p>
<p>#include <queue></queue></p>
<p>#include <set></set></p>
<p>#include <map></map></p>
<p>#include <string></string></p>
<p>#include &lt;math.h&gt;</p>
<p>#include &lt;stdlib.h&gt;</p>
<p>#include &lt;time.h&gt;<br>using namespace std;<br>const int MAXN = 100010;<br>const int SEED = 133331;<br>int n,m;<br>char str[MAXN];<br>char ss[8][MAXN];<br>unsigned long long P[MAXN];<br>unsigned long long hs[MAXN];<br>unsigned long long hss[8][MAXN];<br>//检查ss[id]的[l1,r1] 和 str的[l2,r2]是不是一样<br>bool check(int id,int l1,int r1,int l2,int r2){<br>    unsigned long long tmp1 = hss[id][r1] - hss[id][l1-1]<em>P[(r1-l1+1)];<br>    unsigned long long tmp2 = hs[r2] - hs[l2-1]</em>P[(r2-l2+1)];<br>    return tmp1 == tmp2;<br>}<br>bool first;<br>void output(int id,int x){<br>    if(first)first = false;<br>    else printf(“ “);<br>    if(id &lt; 4){<br>        printf(“%d”,id<em>n+x);<br>    }<br>    else printf(“%d”,(id-4)</em>n+(n+1-x));<br>}<br>int pre[MAXN][8];<br>void print(int i,int id){<br>    if(i &lt;= n){<br>        for(int j = n-i+1;j &lt;= n;j++)<br>            output(id,j);<br>        return;<br>    }<br>    print(i-n,pre[i][id]);<br>    for(int j = 1;j &lt;= n;j++)<br>        output(id,j);<br>}<br>void gao(){<br>    for(int i = 0;i &lt; 8;i++){<br>        hss[i][0] = 0;<br>        for(int j = 1;j &lt;= n;j++)<br>            hss[i][j] = hss[i][j-1]<em>SEED + ss[i][j-1];<br>    }<br>    hs[0] = 0;<br>    for(int i = 1;i &lt;= m;i++)<br>        hs[i] = hs[i-1]</em>SEED + str[i-1];<br>    first = true;<br>    if(m &lt;= n){<br>        for(int i = 0;i &lt; 8;i++)<br>            for(int j = 1;j+m-1 &lt;= n;j++)<br>                if(check(i,j,j+m-1,1,m)){<br>                    for(int k = j;k &lt;= j+m-1;k++)<br>                        output(i,k);<br>                    printf(“\n”);<br>                    return;<br>                }<br>    }<br>    memset(pre,-1,sizeof(pre));<br>    for(int i = 1;i &lt;= m;i++)<br>        for(int j = 0;j &lt; 8;j++){<br>            if(i &lt;= n){<br>                if(check(j,n-i+1,n,1,i))<br>                    pre[i][j] = 0;<br>            }<br>            //printf(“i %d j %d %d\n”,i,j,pre[i][j]);<br>            if(pre[i][j] == -1)continue;<br>            for(int k = 0;k &lt; 8;k++){<br>                if(k == j+4 || k == j-4)continue;<br>                if(i+n &gt;= m){<br>                    if(check(k,1,m-i,i+1,m)){<br>                        print(i,j);<br>                        for(int x = 1;x &lt;= m-i;x++)<br>                            output(k,x);<br>                        printf(“\n”);<br>                        return;<br>                    }<br>                    continue;<br>                }<br>                if(check(k,1,n,i+1,i+n)){<br>                    pre[i+n][k] = j;<br>                }<br>            }<br>        }<br>    printf(“No solution!\n”);<br>}<br>int main()<br>{<br>    //freopen(“in.txt”,”r”,stdin);<br>    //freopen(“out.txt”,”w”,stdout);<br>    P[0] = 1;<br>    for(int i = 1;i &lt; MAXN;i++)<br>        P[i] = P[i-1]*SEED;<br>    int T;<br>    scanf(“%d”,&amp;T);<br>    while(T–){<br>        scanf(“%d%d”,&amp;n,&amp;m);<br>        for(int i = 0;i &lt; 4;i++){<br>            scanf(“%s”,ss[i]);<br>            strcpy(ss[i+4],ss[i]);<br>            reverse(ss[i+4],ss[i+4]+n);<br>        }<br>        scanf(“%s”,str);<br>        gao();<br>    }<br>    return 0;<br>}</p>

          
        
      
    </div>

    

    
    
    
	
	<div>
		
	</div>
 
	<div>
      
	</div>

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://kuangbin.github.io/2014/10/02/uvalive5879/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="kuangbin">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/blogLogo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="kuangbin的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2014/10/02/uvalive5879/" itemprop="url">
                  UVALive 5879 - Boring Card Game （解模线性方程，暴力枚举）
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2014-10-02 19:01:52" itemprop="dateCreated datePublished" datetime="2014-10-02T19:01:52+08:00">2014-10-02</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2018-07-29 13:43:28" itemprop="dateModified" datetime="2018-07-29T13:43:28+08:00">2018-07-29</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Online-Judge/" itemprop="url" rel="index"><span itemprop="name">Online Judge</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Online-Judge/UVALive/" itemprop="url" rel="index"><span itemprop="name">UVALive</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Online-Judge/UVALive/模线性方程组/" itemprop="url" rel="index"><span itemprop="name">模线性方程组</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Online-Judge/UVALive/模线性方程组/算法/" itemprop="url" rel="index"><span itemprop="name">算法</span></a></span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2014/10/02/uvalive5879/#comments" itemprop="discussionUrl">
                
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2014/10/02/uvalive5879/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><a href="https://icpcarchive.ecs.baylor.edu/index.php?option=com_onlinejudge&amp;Itemid=8&amp;page=show_problem&amp;problem=3890" target="_blank" rel="noopener">UVALive5879</a>   题意： 就是规定了一个发牌和收牌的规则。 总共N个人玩游戏，有5*N张牌（分别是1,2,….5N）, 按照规则发牌，如果有一个人拿到了1,2,3,4,5的牌，这个人就赢了，否则进行收牌，然后再来。 要预测是第几个人赢，，以及第几次赢。   就是发牌规则和收牌规则得到一个映射关系，这其实是一个置换群。 然后就可以暴力枚举5张牌的位置，以及哪个人赢。  之后就解一个模线性方程组了。   卧槽！ 竟然没看出来这其实是置换群，这样就是一个一个环组成。 我还n^2去找然后TLE。 弱！  </p>
<p>#include &lt;stdio.h&gt;</p>
<p>#include <algorithm></algorithm></p>
<p>#include <iostream></iostream></p>
<p>#include <queue></queue></p>
<p>#include <set></set></p>
<p>#include &lt;string.h&gt;</p>
<p>#include <map></map></p>
<p>#include <vector></vector></p>
<p>#include <string></string></p>
<p>#include &lt;math.h&gt;<br>using namespace std;<br>namespace ME{<br>    long long extend_gcd(long long a,long long b,long long &amp;x,long long &amp;y){<br>        if(a == 0 &amp;&amp; b == 0)return -1;<br>        if(b == 0){x = 1; y = 0; return a;}<br>        long long d = extend_gcd(b,a%b,y,x);<br>        y -= a/b<em>x;<br>        return d;<br>    }<br>    long long m[10],a[10];<br>    bool solve(long long &amp;m0,long long &amp;a0,int m,int a){<br>        long long y,x;<br>        long long g = extend_gcd(m0,m,x,y);<br>        if(abs(a-a0)%g)return false;<br>        x </em>= (a-a0)/g;<br>        x %= m/g;<br>        a0 = (x<em>m0 + a0);<br>        m0 </em>= m/g;<br>        a0 %= m0;<br>        if(a0 &lt; 0)a0 += m0;<br>        return true;<br>    }<br>    bool MLES(long long &amp;m0,long long &amp;a0,int n){<br>        bool flag = true;<br>        m0 = 1;<br>        a0 = 0;<br>        for(int i = 0;i &lt; n;i++){<br>            if(!solve(m0,a0,m[i],a[i])){<br>                flag = false;<br>                break;<br>            }<br>        }<br>        return flag;<br>    }<br>};</p>
<p>const int MAXN = 5010;<br>int link[MAXN];<br>int a[MAXN];<br>int b[MAXN];<br>int belong[MAXN];<br>int pe[MAXN];<br>int id[MAXN];<br>long long ans[MAXN];<br>int main()<br>{<br>    //freopen(“in.txt”,”r”,stdin);<br>    //freopen(“out.txt”,”w”,stdout);<br>    int n;<br>    while(scanf(“%d”,&amp;n) == 1 &amp;&amp; n){<br>        for(int i = 1;i &lt;= 5<em>n;i++)scanf(“%d”,&amp;a[i]);<br>        for(int i = 1;i &lt;= 5</em>n;i++)b[a[i]] = i;<br>        for(int i = 1;i &lt;= n;i++){<br>            link[2<em>(i-1)+1] = 5</em>(i-1)+1;<br>            link[2<em>(i-1)+2] = 5</em>(i-1)+2;<br>            link[2*n + 2*(i-1)+1] = 5<em>(i-1)+3;<br>            link[2\</em>n + 2*(i-1)+2] = 5<em>(i-1)+4;<br>            link[4\</em>n + (i-1) + 1] = 5*(i-1)+5;<br>        }<br>        memset(belong,-1,sizeof(belong));<br>        for(int i = 1;i &lt;= 5<em>n;i++){<br>            if(belong[i] != -1)continue;<br>            int u = i;<br>            int cnt = 0;<br>            while(belong[u] == -1){<br>                belong[u] = i;<br>                id[u] = cnt;<br>                cnt++;<br>                u = link[u];<br>            }<br>            pe[i] = cnt;<br>            for(int j = link[i];j != i;j = link[j])<br>                pe[j] = cnt;<br>        }<br>        memset(ans,-1,sizeof(ans));<br>        for(int i = 1;i &lt;= n;i++){<br>            int c[10];<br>            c[1] = 2</em>(i-1)+1;<br>            c[2] = 2<em>(i-1)+2;<br>            c[3] = 2\</em>n + 2*(i-1)+1;<br>            c[4] = 2*n + 2*(i-1)+2;<br>            c[5] = 4*n + i;<br>            do{<br>                bool flag = true;<br>                for(int j = 1;j &lt;= 5;j++){<br>                    if(belong[b[j]] != belong[c[j]]){<br>                        flag = false;<br>                        break;<br>                    }<br>                }<br>                if(!flag)continue;<br>                for(int j = 1;j &lt;= 5;j++){<br>                    ME::m[j-1] = pe[b[j]];<br>                    ME::a[j-1] = (id[c[j]] - id[b[j]] + pe[b[j]])%pe[b[j]];<br>                }<br>                long long m0,a0;<br>                if(!ME::MLES(m0,a0,5))continue;<br>                if(ans[i] == -1)ans[i] = a0;<br>                else if(ans[i] &gt; a0)ans[i] = a0;</p>
<pre><code>        }
        while(next_permutation(c+1,c+6));
    }
    long long Min = -1;
    int id  = -1;
    for(int i = 1;i &lt;= n;i++){
        if(ans\[i\] == -1)continue;
        if(Min == -1 || Min &gt; ans\[i\]){
            Min = ans\[i\];
            id = i;
        }
    }
    if(id == -1)printf(&quot;Neverending game.\\n&quot;);
    else printf(&quot;Player %d wins game number %lld.\\n&quot;,id,ans\[id\]+1);
}
return 0;
</code></pre><p>}</p>

          
        
      
    </div>

    

    
    
    
	
	<div>
		
	</div>
 
	<div>
      
	</div>

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://kuangbin.github.io/2014/10/02/zoj2112/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="kuangbin">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/blogLogo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="kuangbin的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2014/10/02/zoj2112/" itemprop="url">
                  ZOJ 2112 Dynamic Rankings （动态区间第k大， 替罪羊树套splay）
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2014-10-02 09:45:02" itemprop="dateCreated datePublished" datetime="2014-10-02T09:45:02+08:00">2014-10-02</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2018-07-29 13:43:28" itemprop="dateModified" datetime="2018-07-29T13:43:28+08:00">2018-07-29</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Online-Judge/" itemprop="url" rel="index"><span itemprop="name">Online Judge</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Online-Judge/splay-tree/" itemprop="url" rel="index"><span itemprop="name">splay tree</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Online-Judge/splay-tree/ZJU/" itemprop="url" rel="index"><span itemprop="name">ZJU</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Online-Judge/splay-tree/ZJU/数据结构/" itemprop="url" rel="index"><span itemprop="name">数据结构</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Online-Judge/splay-tree/ZJU/数据结构/替罪羊树/" itemprop="url" rel="index"><span itemprop="name">替罪羊树</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Online-Judge/splay-tree/ZJU/数据结构/替罪羊树/算法/" itemprop="url" rel="index"><span itemprop="name">算法</span></a></span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2014/10/02/zoj2112/#comments" itemprop="discussionUrl">
                
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2014/10/02/zoj2112/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><a href="http://acm.zju.edu.cn/onlinejudge/showProblem.do?problemId=1112" target="_blank" rel="noopener">ZOJ2112</a>   有点大材小用了。 替罪羊树套splay的话，可以在线搞，而且支持插入删除等操作。 本题只有查询和修改操作。 完全可以把替罪羊树换成树状数组或者线段树了。 其实这里用替罪羊树，也没啥作用，重构操作都没有。就是当成线段树用的。   比较容易MLE。</p>
<p>Dynamic Rankings</p>
<hr>
<p>Time Limit: 10 Seconds      Memory Limit: 32768 KB</p>
<hr>
<p>The Company Dynamic Rankings has developed a new kind of computer that is no longer satisfied with the query like to simply find the k-th smallest number of the given N numbers. They have developed a more powerful system such that for N numbers a[1], a[2], …, a[N], you can ask it like: what is the k-th smallest number of a[i], a[i+1], …, a[j]? (For some i&lt;=j, 0&lt;k&lt;=j+1-i that you have given to it). More powerful, you can even change the value of some a[i], and continue to query, all the same. Your task is to write a program for this computer, which - Reads N numbers from the input (1 &lt;= N &lt;= 50,000) - Processes M instructions of the input (1 &lt;= M &lt;= 10,000). These instructions include querying the k-th smallest number of a[i], a[i+1], …, a[j] and change some a[i] to t. <strong>Input</strong> The first line of the input is a single number X (0 &lt; X &lt;= 4), the number of the test cases of the input. Then X blocks each represent a single test case. The first line of each block contains two integers N and M, representing N numbers and M instruction. It is followed by N lines. The (i+1)-th line represents the number a[i]. Then M lines that is in the following format Q i j k or C i t It represents to query the k-th number of a[i], a[i+1], …, a[j] and change some a[i] to t, respectively. It is guaranteed that at any time of the operation. Any number a[i] is a non-negative integer that is less than 1,000,000,000. There’re NO breakline between two continuous test cases. <strong>Output</strong> For each querying operation, output one integer to represent the result. (i.e. the k-th smallest number of a[i], a[i+1],…, a[j]) There’re NO breakline between two continuous test cases. <strong>Sample Input</strong> 2 5 3 3 2 1 4 7 Q 1 4 3 C 2 6 Q 2 5 3 5 3 3 2 1 4 7 Q 1 4 3 C 2 6 Q 2 5 3 <strong>Sample Output</strong> 3 6 3 6        </p>
<p>/* <strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong>***</strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong><br>Author        :kuangbin<br>Created Time  :2014/10/2 8:59:47<br>File Name     :ZOJ2112.cpp<br>************************************************ */</p>
<p>#include &lt;stdio.h&gt;</p>
<p>#include &lt;string.h&gt;</p>
<p>#include <iostream></iostream></p>
<p>#include <algorithm></algorithm></p>
<p>#include <vector></vector></p>
<p>#include <queue></queue></p>
<p>#include <set></set></p>
<p>#include <map></map></p>
<p>#include <string></string></p>
<p>#include &lt;math.h&gt;</p>
<p>#include &lt;stdlib.h&gt;</p>
<p>#include &lt;time.h&gt;<br>using namespace std;<br>using namespace std;<br>const int MAXN = 50010;<br>namespace Splay{<br>    struct Node <em>null;<br>    struct Node{<br>        Node \</em>ch[2],*fa;<br>        int size,key,cnt;<br>        inline void setc(Node <em>p,int d){<br>            ch[d] = p;<br>            p-&gt;fa = this;<br>        }<br>        inline bool d(){<br>            return fa-&gt;ch[1] == this;<br>        }<br>        inline void push_up(){<br>            size = ch[0]-&gt;size + ch[1]-&gt;size + cnt;<br>        }<br>        void clear(int _key){<br>            size = cnt = 1;<br>            key = _key;<br>            ch[0] = ch[1] = fa = null;<br>        }<br>        inline bool isroot(){<br>            return fa == null || this != fa-&gt;ch[0] &amp;&amp; this != fa-&gt;ch[1];<br>        }<br>    };<br>    Node pool[MAXN\</em>15],*tail;<br>    Node <em>bc[MAXN];<br>    int bc_top;//内存回收<br>    void init(){<br>        tail = pool;<br>        bc_top = 0;<br>        null = tail++;<br>        null-&gt;size = null-&gt;cnt = 0;<br>        null-&gt;ch[0] = null-&gt;ch[1] = null-&gt;fa = null;<br>    }<br>    inline void rotate(Node </em>x){<br>        Node *f = x-&gt;fa, *ff = x-&gt;fa-&gt;fa;<br>        int c = x-&gt;d(), cc = f-&gt;d();<br>        f-&gt;setc(x-&gt;ch[!c],c);<br>        x-&gt;setc(f,!c);<br>        if(ff-&gt;ch[cc] == f)ff-&gt;setc(x,cc);<br>        else x-&gt;fa = ff;<br>        f-&gt;push_up();<br>    }<br>    inline void splay(Node<em> &amp;root,Node</em> x,Node<em> goal){<br>        while(x-&gt;fa != goal){<br>            if(x-&gt;fa-&gt;fa == goal)rotate(x);<br>            else {<br>                bool f = x-&gt;fa-&gt;d();<br>                x-&gt;d() == f ? rotate(x-&gt;fa) : rotate(x);<br>                rotate(x);<br>            }<br>        }<br>        x-&gt;push_up();<br>        if(goal == null)root = x;<br>    }<br>    //找到r子树里面的最左边那个<br>    Node</em> get_left(Node<em> r){<br>        Node</em> x = r;<br>        while(x-&gt;ch[0] != null)x = x-&gt;ch[0];<br>        return x;<br>    }<br>    //在root的树中删掉x<br>    void erase(Node<em> &amp;root,Node</em> x){<br>        splay(root,x,null);<br>        Node<em> t = root;<br>        if(t-&gt;ch[1] != null){<br>            root = t-&gt;ch[1];<br>            splay(root,get_left(t-&gt;ch[1]),null);<br>            root-&gt;setc(t-&gt;ch[0],0);<br>        }<br>        else root = root-&gt;ch[0];<br>        bc[bc_top++] = x;<br>        root-&gt;fa = null;<br>        if(root != null)root-&gt;push_up();<br>    }<br>    Node</em> newNode(int key){<br>        Node<em> p;<br>        if(bc_top)p = bc[–bc_top];<br>        else p = tail++;<br>        p-&gt;clear(key);<br>        return p;<br>    }<br>    //插入一个值key<br>    void insert(Node</em> &amp;root,int key){<br>        if(root == null){<br>            root = newNode(key);<br>            return;<br>        }<br>        Node<em> now = root;<br>        Node</em> pre = root-&gt;fa;<br>        while(now != null){<br>            if(now-&gt;key == key){<br>                now-&gt;cnt++;<br>                splay(root,now,null);<br>                return;<br>            }<br>            pre = now;<br>            now = now-&gt;ch[key &gt;= now-&gt;key];<br>        }<br>        Node <em>x = newNode(key);<br>        pre-&gt;setc(x,key &gt;= pre-&gt;key);<br>        splay(root,x,null);<br>    }<br>    //删除一个值key<br>    void erase(Node</em> &amp;root,int key){<br>        Node<em> now = root;<br>        while(now-&gt;key != key){<br>            now = now-&gt;ch[key &gt;= now-&gt;key];<br>        }<br>        now-&gt;cnt–;<br>        if(now-&gt;cnt == 0)erase(root,now);<br>        else splay(root,now,null);<br>    }<br>    void Travel(Node</em> r){<br>        if(r == null)return;<br>        Travel(r-&gt;ch[0]);<br>        bc[bc_top++] = r;<br>        Travel(r-&gt;ch[1]);<br>    }<br>    void CLEAR(Node<em> &amp;root){<br>        Travel(root);<br>        root = null;<br>    }<br>    //查询小于等于val的个数<br>    int query(Node </em>root,int val){<br>        int ans = 0;<br>        Node <em>x = root;<br>        while(x != null){<br>            if(val &lt; x-&gt;key)x = x-&gt;ch[0];<br>            else{<br>                ans += x-&gt;ch[0]-&gt;size + x-&gt;cnt;<br>                x = x-&gt;ch[1];<br>            }<br>        }<br>        return ans;<br>    }<br>};<br>namespace ScapeGoatTree{<br>    const double alpha = 0.75;<br>    struct Node{<br>        Node </em>ch[2];<br>        int size,nodeCount,key;<br>        Splay::Node <em>root;<br>        bool isBad(){<br>            return ch[0]-&gt;nodeCount &gt; alpha\</em>nodeCount+5 || ch[1]-&gt;nodeCount &gt; alpha*nodeCount+5;<br>        }<br>        void push_up(){<br>            size = 1+ch[0]-&gt;size+ch[1]-&gt;size;<br>            nodeCount = 1+ch[0]-&gt;nodeCount+ch[1]-&gt;nodeCount;<br>        }<br>    };<br>    Node pool[MAXN];<br>    Node *tail,*root,<em>null;<br>    Node </em>bc[MAXN];//用不上<br>    int bc_top;<br>    void init(){<br>        tail = pool;<br>        null = tail++;<br>        null-&gt;ch[0] = null-&gt;ch[1] = null;<br>        null-&gt;size = null-&gt;nodeCount = 0;<br>        null-&gt;root = Splay::null;<br>        bc_top = 0;<br>    }<br>    inline Node<em> newNode(int key){<br>        Node </em>p;<br>        if(bc_top)p = bc[–bc_top];<br>        else p = tail++;<br>        p-&gt;key = key;<br>        p-&gt;ch[0] = p-&gt;ch[1] = null;<br>        p-&gt;size = p-&gt;nodeCount = 1;<br>        p-&gt;root = Splay::null;<br>        return p;<br>    }<br>    Node *buildTree(int *a,int l,int r){<br>        if(l &gt;= r)return null;<br>        int mid = (l+r)/2;<br>        Node <em>p = newNode(a[mid]);<br>        for(int i = l;i &lt; r;i++)<br>            Splay::insert(p-&gt;root,a[i]);<br>        p-&gt;ch[0] = buildTree(a,l,mid);<br>        p-&gt;ch[1] = buildTree(a,mid+1,r);<br>        p-&gt;push_up();<br>        return p;<br>    }<br>    void Travel(Node </em>p,vector<int>&amp;v){<br>        if(p == null)return;<br>        Travel(p-&gt;ch[0],v);<br>        v.push_back(p-&gt;key);<br>        Splay::CLEAR(p-&gt;root);<br>        bc[bc_top++] = p;<br>        Travel(p-&gt;ch[1],v);<br>    }<br>    Node <em>divide(vector<int>&amp;v,int l,int r){<br>        if(l == r)return null;<br>        int mid = (l+r)/2;<br>        Node </int></em>p = newNode(v[mid]);<br>        for(int i = l;i &lt; r;i++)<br>            Splay::insert(p-&gt;root,v[i]);<br>        p-&gt;ch[0] = divide(v,l,mid);<br>        p-&gt;ch[1] = divide(v,mid+1,r);<br>        p-&gt;push_up();<br>        return p;<br>    }<br>    inline void rebuild(Node <em>&amp;p){<br>        vector<int>v;<br>        Travel(p,v);<br>        p = divide(v,0,v.size());<br>    }<br>    //将第id个值修改为val<br>    int Modify(Node </int></em>p,int id,int val){<br>        if(id == p-&gt;ch[0]-&gt;size+1){<br>            int v = p-&gt;key;<br>            Splay::erase(p-&gt;root,v);<br>            Splay::insert(p-&gt;root,val);<br>            p-&gt;key = val;<br>            return v;<br>        }<br>        int res;<br>        if(p-&gt;ch[0]-&gt;size &gt;= id)<br>            res = Modify(p-&gt;ch[0],id,val);<br>        else res = Modify(p-&gt;ch[1],id-p-&gt;ch[0]-&gt;size-1,val);<br>        Splay::erase(p-&gt;root,res);<br>        Splay::insert(p-&gt;root,val);<br>        return res;<br>    }<br>    Node **insert(Node *&amp;p,int id,int val){<br>        if(p == null){<br>            p = newNode(val);<br>            Splay::insert(p-&gt;root,val);<br>            return &null;<br>        }<br>        else {<br>            p-&gt;size++;<br>            p-&gt;nodeCount++;<br>            Splay::insert(p-&gt;root,val);<br>            Node <strong> res;<br>            if(id &lt;= p-&gt;ch[0]-&gt;size+1)<br>                res = insert(p-&gt;ch[0],id,val);<br>            else res = insert(p-&gt;ch[1],id-p-&gt;ch[0]-&gt;size-1,val);<br>            if(p-&gt;isBad())res = &p;<br>            return res;<br>        }<br>    }<br>    void insert(int id,int val){<br>        Node </strong>p = insert(root,id,val);<br>        if(*p != null)rebuild(*p);<br>    }<br>    //查询在[l,r]区间，值小于等于val的个数<br>    int query(Node <em>p,int l,int r,int val){<br>        if(p == null)return 0;<br>        if(l &lt;= 1 &amp;&amp; p-&gt;size &lt;= r)<br>            return Splay::query(p-&gt;root,val);<br>        else {<br>            int ans = 0;<br>            if(l &lt;= p-&gt;ch[0]-&gt;size)<br>                ans += query(p-&gt;ch[0],l,r,val);<br>            if(r &gt; p-&gt;ch[0]-&gt;size+1)<br>                ans += query(p-&gt;ch[1],l-p-&gt;ch[0]-&gt;size-1,r-p-&gt;ch[0]-&gt;size-1,val);<br>            if(p-&gt;key &lt;= val &amp;&amp; l &lt;= p-&gt;ch[0]-&gt;size+1 &amp;&amp; p-&gt;ch[0]-&gt;size+1 &lt;= r)<br>                ans++;<br>            return ans;<br>        }<br>    }<br>    int query(int L,int R,int k){<br>        int ans;<br>        int l = 0, r = 1000000000;<br>        while(l &lt;= r){<br>            int mid = (l+r)/2;<br>            if(query(root,L,R,mid) &gt;= k){<br>                ans = mid;<br>                r = mid-1;<br>            }<br>            else l = mid+1;<br>        }<br>        return ans;<br>    }<br>    void debug(Node </em>p){<br>        if(p == null)return;<br>        debug(p-&gt;ch[0]);<br>        printf(“%d key  %d  lc %d  rc %d  size %d\n”,p-pool,p-&gt;key,p-&gt;ch[0]-pool,p-&gt;ch[1]-pool,p-&gt;root-&gt;size);<br>        debug(p-&gt;ch[1]);<br>    }<br>};<br>int a[MAXN];<br>int main()<br>{<br>    int T;<br>    int n,m;<br>    scanf(“%d”,&amp;T);<br>    while(T–){<br>        scanf(“%d%d”,&amp;n,&amp;m);<br>        Splay::init();<br>        ScapeGoatTree::init();<br>        for(int i = 0;i &lt; n;i++)scanf(“%d”,&amp;a[i]);<br>        ScapeGoatTree::root = ScapeGoatTree::buildTree(a,0,n);<br>        //ScapeGoatTree::debug(ScapeGoatTree::root);<br>        char op[10];<br>        while(m–){<br>            scanf(“%s”,op);<br>            if(op[0] == ‘Q’){<br>                int x,y,k;<br>                scanf(“%d%d%d”,&amp;x,&amp;y,&amp;k);<br>                int ans = ScapeGoatTree::query(x,y,k);<br>                printf(“%d\n”,ans);<br>            }<br>            else if(op[0] == ‘C’){<br>                int x,val;<br>                scanf(“%d%d”,&amp;x,&amp;val);<br>                ScapeGoatTree::Modify(ScapeGoatTree::root,x,val);<br>            }<br>        }<br>    }<br>    return 0;<br>}</int></p>

          
        
      
    </div>

    

    
    
    
	
	<div>
		
	</div>
 
	<div>
      
	</div>

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://kuangbin.github.io/2014/10/02/bzoj3065/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="kuangbin">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/blogLogo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="kuangbin的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2014/10/02/bzoj3065/" itemprop="url">
                  BZOJ 3065 带插入区间K小值 （替罪羊树套splay）
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2014-10-02 00:32:17" itemprop="dateCreated datePublished" datetime="2014-10-02T00:32:17+08:00">2014-10-02</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2018-07-29 20:48:06" itemprop="dateModified" datetime="2018-07-29T20:48:06+08:00">2018-07-29</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Online-Judge/" itemprop="url" rel="index"><span itemprop="name">Online Judge</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/算法/" itemprop="url" rel="index"><span itemprop="name">算法</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/splay-tree/" itemprop="url" rel="index"><span itemprop="name">splay tree</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/数据结构/" itemprop="url" rel="index"><span itemprop="name">数据结构</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/替罪羊树/" itemprop="url" rel="index"><span itemprop="name">替罪羊树</span></a></span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2014/10/02/bzoj3065/#comments" itemprop="discussionUrl">
                
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2014/10/02/bzoj3065/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><a href="http://www.lydsy.com/JudgeOnline/problem.php?id=3065" target="_blank" rel="noopener">BZOJ3065</a> 带插入、修改的区间k小值在线查询。   网上看的别人的做法确实没看懂， 然后自己想了一下，用替罪羊树套上splay去搞。 替罪羊树维护相对位置信息，然后每个子树用splay去维护值。 这样就可以查询一个区间 &lt;= val的出现了几次。   替罪羊树重要的是不会旋转，维护起来很好维护。   就是代码比较长了，splay+替罪羊， 300+行代码， 1A了，怕不怕！    </p>
<h2 id="3065-带插入区间K小值"><a href="#3065-带插入区间K小值" class="headerlink" title="3065: 带插入区间K小值"></a>3065: 带插入区间K小值</h2><p>Time Limit: 60 Sec  Memory Limit: 512 MB Submit: 810  Solved: 184 [<a href="http://www.lydsy.com/JudgeOnline/submitpage.php?id=3065" target="_blank" rel="noopener">Submit</a>][<a href="http://www.lydsy.com/JudgeOnline/problemstatus.php?id=3065" target="_blank" rel="noopener">Status</a>]</p>
<h2 id="Description"><a href="#Description" class="headerlink" title="Description"></a>Description</h2><p>从前有n只跳蚤排成一行做早操，每只跳蚤都有自己的一个弹跳力a[i]。跳蚤国王看着这些跳蚤国欣欣向荣的情景，感到非常高兴。这时跳蚤国王决定理性愉悦一下，查询区间k小值。他每次向它的随从伏特提出这样的问题: 从左往右第x个到第y个跳蚤中，a[i]第k小的值是多少。 这可难不倒伏特，他在脑袋里使用函数式线段树前缀和的方法水掉了跳蚤国王的询问。 这时伏特发现有些跳蚤跳久了弹跳力会有变化，有的会增大，有的会减少。 这可难不倒伏特，他在脑袋里使用树状数组套线段树的方法水掉了跳蚤国王的询问。（orz 主席树） 这时伏特发现有些迟到的跳蚤会插入到这一行的某个位置上，他感到非常生气，因为……他不会做了。 请你帮一帮伏特吧。 快捷版题意：带插入、修改的区间k小值在线查询。</p>
<h2 id="Input"><a href="#Input" class="headerlink" title="Input"></a>Input</h2><p>第一行一个正整数n，表示原来有n只跳蚤排成一行做早操。 第二行有n个用空格隔开的非负整数，从左至右代表每只跳蚤的弹跳力。 第三行一个正整数q，表示下面有多少个操作。 下面一共q行，一共三种操作对原序列的操作：（假设此时一共m只跳蚤） 1. Q x y k: 询问从左至右第x只跳蚤到从左至右第y只跳蚤中，弹跳力第k小的跳蚤的弹跳力是多少。 (1 &lt;= x &lt;= y &lt;= m, 1 &lt;= k &lt;= y - x + 1) 2. M x val: 将从左至右第x只跳蚤的弹跳力改为val。 (1 &lt;= x &lt;= m) 3. I x val: 在从左至右第x只跳蚤的前面插入一只弹跳力为val的跳蚤。即插入后从左至右第x只跳蚤是我刚插入的跳蚤。 (1 &lt;= x &lt;= m + 1) 为了体现在线操作，设lastAns为上一次查询的时候程序输出的结果，如果之前没有查询过，则lastAns = 0。 则输入的时候实际是： Q _x _y _k ——&gt; 表示 Q _x^lastAns _y^lastAns _k^lastAns M _x _val  ——&gt; 表示 M _x^lastAns _val^lastAns I _x _val  ——&gt; 表示 I _x^lastAns _val^lastAns 简单来说就是操作中输入的整数都要异或上一次询问的结果进行解码。 (祝Pascal的同学早日转C++，就不提供pascal版的描述了。)</p>
<h2 id="Output"><a href="#Output" class="headerlink" title="Output"></a>Output</h2><p>对于每个询问输出回答，每行一个回答。</p>
<h2 id="Sample-Input"><a href="#Sample-Input" class="headerlink" title="Sample Input"></a>Sample Input</h2><p>10 10 5 8 28 0 19 2 31 1 22 30 I 6 9 M 1 11 I 8 17 M 1 31 M 6 26 Q 2 7 6 I 23 30 M 31 7 I 22 27 M 26 18 Q 26 17 31 I 5 2 I 18 13 Q 3 3 3 I 27 19 Q 23 23 30 Q 5 13 5 I 3 0 M 15 27 Q 0 28 13 Q 3 29 11 M 2 8 Q 12 5 7 I 30 19 M 11 19 Q 17 8 29 M 29 4 Q 3 0 12 I 7 18 M 29 27</p>
<h2 id="Sample-Output"><a href="#Sample-Output" class="headerlink" title="Sample Output"></a>Sample Output</h2><p>28 2 31 0 14 15 14 27 15 14</p>
<h2 id="HINT"><a href="#HINT" class="headerlink" title="HINT"></a>HINT</h2><p>此题作为一个小小的研究来搞吧～做法有很多～不知道这题究竟有多少种做法。 请自觉O(log^2n)，我故意卡块状链表，块链A了的请受我深情一拜…… A掉的同学请在Discuss里面简要说下自己的做法吧～ 原序列长度 &lt;= 35000 插入个数 &lt;= 35000，修改个数 &lt;= 70000，查询个数 &lt;= 70000  ,0 &lt;= 每时每刻的权值 &lt;= 70000 由于是OJ上的题，所以数据无梯度。为了防止卡OJ，本题只有4组数据。</p>
<h2 id="Source"><a href="#Source" class="headerlink" title="Source"></a>Source</h2><p><a href="http://www.lydsy.com/JudgeOnline/problemset.php?search=%E4%BD%9C%E8%80%85%20vfleaking" target="_blank" rel="noopener">作者 vfleaking</a></p>
<pre><code>题目限定值的范围是 0~70000.  我用splay的做法的话，这个值的范围可以很大了。
</code></pre><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* ***************</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">Author        :kuangbin</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">Created Time  :2014/10/1 22:05:45</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">File Name     :E:\2014ACM\专题学习\数据结构\ScapeGoatTree\BZOJ3065.cpp</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">************************************************ */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;queue&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;set&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;map&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;math.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;time.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">70010</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> Splay&#123;</span><br><span class="line"></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">Node</span> *<span class="title">null</span>;</span></span><br><span class="line"></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">Node</span>&#123;</span></span><br><span class="line"></span><br><span class="line">		Node *ch[<span class="number">2</span>],*fa;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">int</span> size,key,cnt;</span><br><span class="line"></span><br><span class="line">		<span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">setc</span><span class="params">(Node *p,<span class="keyword">int</span> d)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">			ch[d] = p;</span><br><span class="line"></span><br><span class="line">			p-&gt;fa = <span class="keyword">this</span>;</span><br><span class="line"></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="function"><span class="keyword">inline</span> <span class="keyword">bool</span> <span class="title">d</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">return</span> fa-&gt;ch[<span class="number">1</span>] == <span class="keyword">this</span>;</span><br><span class="line"></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">push_up</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">			size = ch[<span class="number">0</span>]-&gt;size + ch[<span class="number">1</span>]-&gt;size + cnt;</span><br><span class="line"></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="function"><span class="keyword">void</span> <span class="title">clear</span><span class="params">(<span class="keyword">int</span> _key)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">			size = cnt = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">			key = _key;</span><br><span class="line"></span><br><span class="line">			ch[<span class="number">0</span>] = ch[<span class="number">1</span>] = fa = null;</span><br><span class="line"></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="function"><span class="keyword">inline</span> <span class="keyword">bool</span> <span class="title">isroot</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">return</span> fa == null || <span class="keyword">this</span> != fa-&gt;ch[<span class="number">0</span>] &amp;&amp; <span class="keyword">this</span> != fa-&gt;ch[<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">	&#125;;</span><br><span class="line"></span><br><span class="line">	Node pool[MAXN*<span class="number">20</span>],*tail;</span><br><span class="line"></span><br><span class="line">	Node *bc[MAXN*<span class="number">20</span>];</span><br><span class="line"></span><br><span class="line">	<span class="keyword">int</span> bc_top;<span class="comment">//内存回收</span></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">		tail = pool;</span><br><span class="line"></span><br><span class="line">		bc_top = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">		null = tail++;</span><br><span class="line"></span><br><span class="line">		null-&gt;size = null-&gt;cnt = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">		null-&gt;ch[<span class="number">0</span>] = null-&gt;ch[<span class="number">1</span>] = null-&gt;fa = null;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">rotate</span><span class="params">(Node *x)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">		Node *f = x-&gt;fa, *ff = x-&gt;fa-&gt;fa;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">int</span> c = x-&gt;d(), cc = f-&gt;d();</span><br><span class="line"></span><br><span class="line">		f-&gt;setc(x-&gt;ch[!c],c);</span><br><span class="line"></span><br><span class="line">		x-&gt;setc(f,!c);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span>(ff-&gt;ch[cc] == f)ff-&gt;setc(x,cc);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">else</span> x-&gt;fa = ff;</span><br><span class="line"></span><br><span class="line">		f-&gt;push_up();</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">splay</span><span class="params">(Node* &amp;root,Node* x,Node* goal)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">while</span>(x-&gt;fa != goal)&#123;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">if</span>(x-&gt;fa-&gt;fa == goal)rotate(x);</span><br><span class="line"></span><br><span class="line">			<span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">				<span class="keyword">bool</span> f = x-&gt;fa-&gt;d();</span><br><span class="line"></span><br><span class="line">				x-&gt;d() == f ? rotate(x-&gt;fa) : rotate(x);</span><br><span class="line"></span><br><span class="line">				rotate(x);</span><br><span class="line"></span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		x-&gt;push_up();</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span>(goal == null)root = x;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//找到r子树里面的最左边那个</span></span><br><span class="line"></span><br><span class="line">	<span class="function">Node* <span class="title">get_left</span><span class="params">(Node* r)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">		Node* x = r;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">while</span>(x-&gt;ch[<span class="number">0</span>] != null)x = x-&gt;ch[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> x;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//在root的树中删掉x</span></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">erase</span><span class="params">(Node* &amp;root,Node* x)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">		splay(root,x,null);</span><br><span class="line"></span><br><span class="line">		Node* t = root;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span>(t-&gt;ch[<span class="number">1</span>] != null)&#123;</span><br><span class="line"></span><br><span class="line">			root = t-&gt;ch[<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">			splay(root,get_left(t-&gt;ch[<span class="number">1</span>]),null);</span><br><span class="line"></span><br><span class="line">			root-&gt;setc(t-&gt;ch[<span class="number">0</span>],<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">else</span> root = root-&gt;ch[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">		bc[bc_top++] = x;</span><br><span class="line"></span><br><span class="line">		root-&gt;fa = null;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span>(root != null)root-&gt;push_up();</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function">Node* <span class="title">newNode</span><span class="params">(<span class="keyword">int</span> key)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">		Node* p;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span>(bc_top)p = bc[--bc_top];</span><br><span class="line"></span><br><span class="line">		<span class="keyword">else</span> p = tail++;</span><br><span class="line"></span><br><span class="line">		p-&gt;clear(key);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> p;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//插入一个值key</span></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(Node* &amp;root,<span class="keyword">int</span> key)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span>(root == null)&#123;</span><br><span class="line"></span><br><span class="line">			root = newNode(key);</span><br><span class="line"></span><br><span class="line">			<span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		Node* now = root;</span><br><span class="line"></span><br><span class="line">		Node* pre = root-&gt;fa;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">while</span>(now != null)&#123;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">if</span>(now-&gt;key == key)&#123;</span><br><span class="line"></span><br><span class="line">				now-&gt;cnt++;</span><br><span class="line"></span><br><span class="line">				splay(root,now,null);</span><br><span class="line"></span><br><span class="line">				<span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			pre = now;</span><br><span class="line"></span><br><span class="line">			now = now-&gt;ch[key &gt;= now-&gt;key];</span><br><span class="line"></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		Node *x = newNode(key);</span><br><span class="line"></span><br><span class="line">		pre-&gt;setc(x,key &gt;= pre-&gt;key);</span><br><span class="line"></span><br><span class="line">		splay(root,x,null);</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//删除一个值key</span></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">erase</span><span class="params">(Node* &amp;root,<span class="keyword">int</span> key)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">		Node* now = root;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">while</span>(now-&gt;key != key)&#123;</span><br><span class="line"></span><br><span class="line">			now = now-&gt;ch[key &gt;= now-&gt;key];</span><br><span class="line"></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		now-&gt;cnt--;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span>(now-&gt;cnt == <span class="number">0</span>)erase(root,now);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">else</span> splay(root,now,null);</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Travel</span><span class="params">(Node* r)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span>(r == null)<span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">		Travel(r-&gt;ch[<span class="number">0</span>]);</span><br><span class="line"></span><br><span class="line">		bc[bc_top++] = r;</span><br><span class="line"></span><br><span class="line">		Travel(r-&gt;ch[<span class="number">1</span>]);</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">CLEAR</span><span class="params">(Node* &amp;root)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">		Travel(root);</span><br><span class="line"></span><br><span class="line">		root = null;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//查询小于等于val的个数</span></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(Node *root,<span class="keyword">int</span> val)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">int</span> ans = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">		Node *x = root;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">while</span>(x != null)&#123;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">if</span>(val &lt; x-&gt;key)x = x-&gt;ch[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">			<span class="keyword">else</span>&#123;</span><br><span class="line"></span><br><span class="line">				ans += x-&gt;ch[<span class="number">0</span>]-&gt;size + x-&gt;cnt;</span><br><span class="line"></span><br><span class="line">				x = x-&gt;ch[<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> ans;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> ScapeGoatTree&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">const</span> <span class="keyword">double</span> alpha = <span class="number">0.75</span>;</span><br><span class="line"></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">Node</span>&#123;</span></span><br><span class="line"></span><br><span class="line">		Node *ch[<span class="number">2</span>];</span><br><span class="line"></span><br><span class="line">		<span class="keyword">int</span> size,nodeCount,key;</span><br><span class="line"></span><br><span class="line">		Splay::Node *root;</span><br><span class="line"></span><br><span class="line">		<span class="function"><span class="keyword">bool</span> <span class="title">isBad</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">return</span> ch[<span class="number">0</span>]-&gt;nodeCount &gt; alpha*nodeCount+<span class="number">5</span> || ch[<span class="number">1</span>]-&gt;nodeCount &gt; alpha*nodeCount+<span class="number">5</span>;</span><br><span class="line"></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="function"><span class="keyword">void</span> <span class="title">push_up</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">			size = <span class="number">1</span>+ch[<span class="number">0</span>]-&gt;size+ch[<span class="number">1</span>]-&gt;size;</span><br><span class="line"></span><br><span class="line">			nodeCount = <span class="number">1</span>+ch[<span class="number">0</span>]-&gt;nodeCount+ch[<span class="number">1</span>]-&gt;nodeCount;</span><br><span class="line"></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">	&#125;;</span><br><span class="line"></span><br><span class="line">	Node pool[MAXN];</span><br><span class="line"></span><br><span class="line">	Node *tail,*root,*null;</span><br><span class="line"></span><br><span class="line">	Node *bc[MAXN];</span><br><span class="line"></span><br><span class="line">	<span class="keyword">int</span> bc_top;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">		tail = pool;</span><br><span class="line"></span><br><span class="line">		null = tail++;</span><br><span class="line"></span><br><span class="line">		null-&gt;ch[<span class="number">0</span>] = null-&gt;ch[<span class="number">1</span>] = null;</span><br><span class="line"></span><br><span class="line">		null-&gt;size = null-&gt;nodeCount = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">		null-&gt;root = Splay::null;</span><br><span class="line"></span><br><span class="line">		bc_top = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">inline</span> Node* <span class="title">newNode</span><span class="params">(<span class="keyword">int</span> key)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">		Node *p;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span>(bc_top)p = bc[--bc_top];</span><br><span class="line"></span><br><span class="line">		<span class="keyword">else</span> p = tail++;</span><br><span class="line"></span><br><span class="line">		p-&gt;key = key;</span><br><span class="line"></span><br><span class="line">		p-&gt;ch[<span class="number">0</span>] = p-&gt;ch[<span class="number">1</span>] = null;</span><br><span class="line"></span><br><span class="line">		p-&gt;size = p-&gt;nodeCount = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">		p-&gt;root = Splay::null;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> p;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function">Node *<span class="title">buildTree</span><span class="params">(<span class="keyword">int</span> *a,<span class="keyword">int</span> l,<span class="keyword">int</span> r)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span>(l &gt;= r)<span class="keyword">return</span> null;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">int</span> mid = (l+r)/<span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">		Node *p = newNode(a[mid]);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = l;i &lt; r;i++)</span><br><span class="line"></span><br><span class="line">			Splay::insert(p-&gt;root,a[i]);</span><br><span class="line"></span><br><span class="line">		p-&gt;ch[<span class="number">0</span>] = buildTree(a,l,mid);</span><br><span class="line"></span><br><span class="line">		p-&gt;ch[<span class="number">1</span>] = buildTree(a,mid+<span class="number">1</span>,r);</span><br><span class="line"></span><br><span class="line">		p-&gt;push_up();</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> p;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Travel</span><span class="params">(Node *p,<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp;v)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span>(p == null)<span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">		Travel(p-&gt;ch[<span class="number">0</span>],v);</span><br><span class="line"></span><br><span class="line">		v.push_back(p-&gt;key);</span><br><span class="line"></span><br><span class="line">		Splay::CLEAR(p-&gt;root);</span><br><span class="line"></span><br><span class="line">		bc[bc_top++] = p;</span><br><span class="line"></span><br><span class="line">		Travel(p-&gt;ch[<span class="number">1</span>],v);</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function">Node *<span class="title">divide</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp;v,<span class="keyword">int</span> l,<span class="keyword">int</span> r)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span>(l == r)<span class="keyword">return</span> null;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">int</span> mid = (l+r)/<span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">		Node *p = newNode(v[mid]);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = l;i &lt; r;i++)</span><br><span class="line"></span><br><span class="line">			Splay::insert(p-&gt;root,v[i]);</span><br><span class="line"></span><br><span class="line">		p-&gt;ch[<span class="number">0</span>] = divide(v,l,mid);</span><br><span class="line"></span><br><span class="line">		p-&gt;ch[<span class="number">1</span>] = divide(v,mid+<span class="number">1</span>,r);</span><br><span class="line"></span><br><span class="line">		p-&gt;push_up();</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> p;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">rebuild</span><span class="params">(Node *&amp;p)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">		<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;v;</span><br><span class="line"></span><br><span class="line">		Travel(p,v);</span><br><span class="line"></span><br><span class="line">		p = divide(v,<span class="number">0</span>,v.size());</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//将第id个值修改为val</span></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">Modify</span><span class="params">(Node *p,<span class="keyword">int</span> id,<span class="keyword">int</span> val)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span>(id == p-&gt;ch[<span class="number">0</span>]-&gt;size+<span class="number">1</span>)&#123;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">int</span> v = p-&gt;key;</span><br><span class="line"></span><br><span class="line">			Splay::erase(p-&gt;root,v);</span><br><span class="line"></span><br><span class="line">			Splay::insert(p-&gt;root,val);</span><br><span class="line"></span><br><span class="line">			p-&gt;key = val;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">return</span> v;</span><br><span class="line"></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">int</span> res;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span>(p-&gt;ch[<span class="number">0</span>]-&gt;size &gt;= id)</span><br><span class="line"></span><br><span class="line">			res = Modify(p-&gt;ch[<span class="number">0</span>],id,val);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">else</span> res = Modify(p-&gt;ch[<span class="number">1</span>],id-p-&gt;ch[<span class="number">0</span>]-&gt;size<span class="number">-1</span>,val);</span><br><span class="line"></span><br><span class="line">		Splay::erase(p-&gt;root,res);</span><br><span class="line"></span><br><span class="line">		Splay::insert(p-&gt;root,val);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> res;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function">Node **<span class="title">insert</span><span class="params">(Node *&amp;p,<span class="keyword">int</span> id,<span class="keyword">int</span> val)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span>(p == null)&#123;</span><br><span class="line"></span><br><span class="line">			p = newNode(val);</span><br><span class="line"></span><br><span class="line">			Splay::insert(p-&gt;root,val);</span><br><span class="line"></span><br><span class="line">			<span class="keyword">return</span> &amp;null;</span><br><span class="line"></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">			p-&gt;size++;</span><br><span class="line"></span><br><span class="line">			p-&gt;nodeCount++;</span><br><span class="line"></span><br><span class="line">			Splay::insert(p-&gt;root,val);</span><br><span class="line"></span><br><span class="line">			Node ** res;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">if</span>(id &lt;= p-&gt;ch[<span class="number">0</span>]-&gt;size+<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">				res = insert(p-&gt;ch[<span class="number">0</span>],id,val);</span><br><span class="line"></span><br><span class="line">			<span class="keyword">else</span> res = insert(p-&gt;ch[<span class="number">1</span>],id-p-&gt;ch[<span class="number">0</span>]-&gt;size<span class="number">-1</span>,val);</span><br><span class="line"></span><br><span class="line">			<span class="keyword">if</span>(p-&gt;isBad())res = &amp;p;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">return</span> res;</span><br><span class="line"></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">int</span> id,<span class="keyword">int</span> val)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">		Node **p = insert(root,id,val);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span>(*p != null)rebuild(*p);</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//查询在[l,r]区间，值小于等于val的个数</span></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(Node *p,<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> val)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span>(p == null)<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span>(l &lt;= <span class="number">1</span> &amp;&amp; p-&gt;size &lt;= r)</span><br><span class="line"></span><br><span class="line">			<span class="keyword">return</span> Splay::query(p-&gt;root,val);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">int</span> ans = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">if</span>(l &lt;= p-&gt;ch[<span class="number">0</span>]-&gt;size)</span><br><span class="line"></span><br><span class="line">				ans += query(p-&gt;ch[<span class="number">0</span>],l,r,val);</span><br><span class="line"></span><br><span class="line">			<span class="keyword">if</span>(r &gt; p-&gt;ch[<span class="number">0</span>]-&gt;size+<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">				ans += query(p-&gt;ch[<span class="number">1</span>],l-p-&gt;ch[<span class="number">0</span>]-&gt;size<span class="number">-1</span>,r-p-&gt;ch[<span class="number">0</span>]-&gt;size<span class="number">-1</span>,val);</span><br><span class="line"></span><br><span class="line">			<span class="keyword">if</span>(p-&gt;key &lt;= val &amp;&amp; l &lt;= p-&gt;ch[<span class="number">0</span>]-&gt;size+<span class="number">1</span> &amp;&amp; p-&gt;ch[<span class="number">0</span>]-&gt;size+<span class="number">1</span> &lt;= r)</span><br><span class="line"></span><br><span class="line">				ans++;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">return</span> ans;</span><br><span class="line"></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> L,<span class="keyword">int</span> R,<span class="keyword">int</span> k)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">int</span> ans;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">int</span> l = <span class="number">0</span>, r = <span class="number">100000</span>;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">while</span>(l &lt;= r)&#123;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">int</span> mid = (l+r)/<span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">if</span>(query(root,L,R,mid) &gt;= k)&#123;</span><br><span class="line"></span><br><span class="line">				ans = mid;</span><br><span class="line"></span><br><span class="line">				r = mid<span class="number">-1</span>;</span><br><span class="line"></span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">else</span> l = mid+<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> ans;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> a[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> n;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">while</span>(<span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;n) == <span class="number">1</span>)&#123;</span><br><span class="line"></span><br><span class="line">		Splay::init();</span><br><span class="line"></span><br><span class="line">		ScapeGoatTree::init();</span><br><span class="line"></span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; n;i++)<span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;a[i]);</span><br><span class="line"></span><br><span class="line">		ScapeGoatTree::root = ScapeGoatTree::buildTree(a,<span class="number">0</span>,n);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">int</span> m;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">char</span> op[<span class="number">10</span>];</span><br><span class="line"></span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;m);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">int</span> ans = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">while</span>(m--)&#123;</span><br><span class="line"></span><br><span class="line">			<span class="built_in">scanf</span>(<span class="string">"%s"</span>,op);</span><br><span class="line"></span><br><span class="line">			<span class="keyword">if</span>(op[<span class="number">0</span>] == <span class="string">'Q'</span>)&#123;</span><br><span class="line"></span><br><span class="line">				<span class="keyword">int</span> x,y,k;</span><br><span class="line"></span><br><span class="line">				<span class="built_in">scanf</span>(<span class="string">"%d%d%d"</span>,&amp;x,&amp;y,&amp;k);</span><br><span class="line"></span><br><span class="line">				x ^= ans; y ^= ans; k ^= ans;</span><br><span class="line"></span><br><span class="line">				ans = ScapeGoatTree::query(x,y,k);</span><br><span class="line"></span><br><span class="line">				<span class="built_in">printf</span>(<span class="string">"%d\n"</span>,ans);</span><br><span class="line"></span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">else</span> <span class="keyword">if</span>(op[<span class="number">0</span>] == <span class="string">'M'</span>)&#123;</span><br><span class="line"></span><br><span class="line">				<span class="keyword">int</span> x,val;</span><br><span class="line"></span><br><span class="line">				<span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;x,&amp;val);</span><br><span class="line"></span><br><span class="line">				x ^= ans; val ^= ans;</span><br><span class="line"></span><br><span class="line">				ScapeGoatTree::Modify(ScapeGoatTree::root,x,val);</span><br><span class="line"></span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">else</span> <span class="keyword">if</span>(op[<span class="number">0</span>] == <span class="string">'I'</span>)&#123;</span><br><span class="line"></span><br><span class="line">				<span class="keyword">int</span> x,val;</span><br><span class="line"></span><br><span class="line">				<span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;x,&amp;val);</span><br><span class="line"></span><br><span class="line">				x ^= ans; val ^= ans;</span><br><span class="line"></span><br><span class="line">				ScapeGoatTree::insert(x,val);</span><br><span class="line"></span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    

    
    
    
	
	<div>
		
	</div>
 
	<div>
      
	</div>

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://kuangbin.github.io/2014/10/01/uvalive6045/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="kuangbin">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/blogLogo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="kuangbin的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2014/10/01/uvalive6045/" itemprop="url">
                  UVALive 6045 - Alien Abduction （动态KD树）
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2014-10-01 08:42:05" itemprop="dateCreated datePublished" datetime="2014-10-01T08:42:05+08:00">2014-10-01</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2018-07-29 13:43:28" itemprop="dateModified" datetime="2018-07-29T13:43:28+08:00">2018-07-29</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/KD树/" itemprop="url" rel="index"><span itemprop="name">KD树</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/KD树/Online-Judge/" itemprop="url" rel="index"><span itemprop="name">Online Judge</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/KD树/Online-Judge/UVALive/" itemprop="url" rel="index"><span itemprop="name">UVALive</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/KD树/Online-Judge/UVALive/替罪羊树/" itemprop="url" rel="index"><span itemprop="name">替罪羊树</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/KD树/Online-Judge/UVALive/替罪羊树/算法/" itemprop="url" rel="index"><span itemprop="name">算法</span></a></span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2014/10/01/uvalive6045/#comments" itemprop="discussionUrl">
                
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2014/10/01/uvalive6045/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><a href="https://icpcarchive.ecs.baylor.edu/index.php?option=com_onlinejudge&amp;Itemid=8&amp;page=show_problem&amp;problem=4056" target="_blank" rel="noopener">UAVLive6045</a>   题意： 给了二维平面上的N个整点（\(N \leq 50000\)）。每次操作给了点\((x_i,y_i)\),需要曼哈顿距离小于\(E\)的点进行一个变换。 输出最后的点的坐标，保证变换次数不超过50000.   这题做的方法比较多。   KD树的做法就是先进行坐标选择，转化成找一个矩形内的点。 但是这样的KD树需要进行插入和删除，这样普通的KD树将不能保持平衡。   动态的KD树其实就是KD树结合了替罪羊树的思想。 当不平衡的时候，找替罪羊，然后整颗树进行重构。  </p>
<p>/* <strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong>***</strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong><br>Author        :kuangbin<br>Created Time  :2014/9/30 23:07:14<br>File Name     :E:\2014ACM\专题学习\KD树\UVALive6045.cpp<br>************************************************ */</p>
<p>#include &lt;stdio.h&gt;</p>
<p>#include &lt;string.h&gt;</p>
<p>#include <iostream></iostream></p>
<p>#include <algorithm></algorithm></p>
<p>#include <vector></vector></p>
<p>#include <queue></queue></p>
<p>#include <set></set></p>
<p>#include <map></map></p>
<p>#include <string></string></p>
<p>#include &lt;math.h&gt;</p>
<p>#include &lt;stdlib.h&gt;</p>
<p>#include &lt;time.h&gt;<br>using namespace std;<br>const int MAXN = 100010;<br>const double alpha = 0.75;<br>struct Point{<br>    int x,y,id;<br>};<br>struct Node{<br>    Point e;<br>    int size,nodeCount;<br>    Node *lc,*rc;<br>    bool div;<br>    bool exist;<br>    bool isBad(){<br>        return lc-&gt;nodeCount &gt; alpha*nodeCount+5 || rc-&gt;nodeCount &gt; alpha*nodeCount+5;<br>    }<br>    inline void push_up(){<br>        size = exist + lc-&gt;size + rc-&gt;size;<br>        nodeCount = 1+lc-&gt;nodeCount+rc-&gt;nodeCount;<br>    }<br>};<br>Node pool[MAXN],*tail,*root,<em>null;<br>Node </em>bc[MAXN];<br>int bc_top;<br>void init(){<br>    tail = pool;<br>    null = tail++;<br>    null-&gt;lc = null-&gt;rc = null;<br>    null-&gt;size = null-&gt;nodeCount = 0;<br>    root = null;<br>    bc_top = 0;<br>}<br>Node <em>newNode(Point e){<br>    Node </em>p;<br>    if(bc_top)p = bc[–bc_top];<br>    else p = tail++;<br>    p-&gt;e = e;<br>    p-&gt;lc = p-&gt;rc = null;<br>    p-&gt;size = p-&gt;nodeCount = 1;<br>    p-&gt;exist = true;<br>    return p;<br>}<br>inline bool cmpX(const Point &amp;a,const Point &amp;b){<br>    return a.x &lt; b.x || (a.x == b.x &amp;&amp; a.y &lt; b.y) || (a.x == b.x &amp;&amp; a.y == b.y &amp;&amp; a.id &lt; b.id);<br>}<br>inline bool cmpY(const Point &amp;a,const Point &amp;b){<br>    return a.y &lt; b.y || (a.y == b.y &amp;&amp; a.x &lt; b.x) || (a.y == b.y &amp;&amp; a.x == b.x &amp;&amp; a.id &lt; b.id);<br>}<br>inline bool cmp(const Point &amp;a,const Point &amp;b,bool div){<br>    return div?cmpY(a,b):cmpX(a,b);<br>}<br>//注意a需要备份，否则就乱序<br>Node *build(Point *a,int l,int r,bool div){<br>    if(l &gt;= r)return null;<br>    int mid = (l+r)/2;<br>    nth_element(a+l,a+mid,a+r,div?cmpY:cmpX);<br>    Node <em>p = newNode(a[mid]);<br>    p-&gt;div = div;<br>    p-&gt;lc = build(a,l,mid,!div);<br>    p-&gt;rc = build(a,mid+1,r,!div);<br>    p-&gt;push_up();<br>    return p;<br>}<br>void Travel(Node </em>p,vector<point>&amp;v){<br>    if(p == null)return;<br>    Travel(p-&gt;lc,v);<br>    if(p-&gt;exist)v.push_back(p-&gt;e);<br>    bc[bc_top++] = p;<br>    Travel(p-&gt;rc,v);<br>}<br>Node <em>divide(vector<point>&amp;v,int l,int r,bool div){<br>    if(l &gt;= r)return null;<br>    int mid = (l+r)/2;<br>    nth_element(v.begin()+l,v.begin()+mid,v.begin()+r,div?cmpY:cmpX);<br>    Node </point></em>p = newNode(v[mid]);<br>    p-&gt;div = div;<br>    p-&gt;lc = divide(v,l,mid,!div);<br>    p-&gt;rc = divide(v,mid+1,r,!div);<br>    p-&gt;push_up();<br>    return p;<br>}<br>inline void rebuild(Node <em>&amp;p){<br>    vector<point>v;<br>    Travel(p,v);<br>    p = divide(v,0,v.size(),p-&gt;div);<br>}<br>Node \</point></em>*insert(Node *&amp;p,Point a,bool div){<br>    if(p == null){<br>        p = newNode(a);<br>        p-&gt;div = div;<br>        return &null;<br>    }<br>    else {<br>        p-&gt;nodeCount++;<br>        p-&gt;size++;<br>        Node <strong>res;<br>        if(cmp(a,p-&gt;e,div))<br>            res = insert(p-&gt;lc,a,!div);<br>        else res = insert(p-&gt;rc,a,!div);<br>        if(p-&gt;isBad())res = &p;<br>        return res;<br>    }<br>}<br>void insert(Point e){<br>    Node </strong>p = insert(root,e,0);<br>    if(*p != null)rebuild(*p);<br>}<br>vector<int>vec;<br>void getvec(Node <em>p,int minx,int maxx,int miny,int maxy){<br>    if(p-&gt;size == 0)return;<br>    if(p-&gt;exist &amp;&amp; minx &lt;= p-&gt;e.x &amp;&amp; p-&gt;e.x &lt;= maxx &amp;&amp; miny &lt;= p-&gt;e.y &amp;&amp; p-&gt;e.y &lt;= maxy){<br>        vec.push_back(p-&gt;e.id);<br>        p-&gt;exist = 0;<br>        p-&gt;size–;<br>    }<br>    if(p-&gt;div? miny &lt;= p-&gt;e.y : minx &lt;= p-&gt;e.x)getvec(p-&gt;lc,minx,maxx,miny,maxy);<br>    if(p-&gt;div? maxy &gt;= p-&gt;e.y : maxx &gt;= p-&gt;e.x)getvec(p-&gt;rc,minx,maxx,miny,maxy);<br>    p-&gt;push_up();<br>}<br>Point p[MAXN],p2[MAXN];<br>Point p3[MAXN];<br>int main()<br>{<br>    int T;<br>    scanf(“%d”,&amp;T);<br>    int iCase = 0;<br>    int N,Q,W,H;<br>    while(T–){<br>        iCase++;<br>        scanf(“%d%d%d%d”,&amp;N,&amp;Q,&amp;W,&amp;H);<br>        init();<br>        for(int i = 0;i &lt; N;i++){<br>            scanf(“%d%d”,&amp;p[i].x,&amp;p[i].y);<br>            p[i].id = p2[i].id = i;<br>            p2[i].x = p[i].x+p[i].y;<br>            p2[i].y = p[i].x-p[i].y;<br>            p3[i] = p2[i];<br>        }<br>        root = build(p3,0,N,0);<br>        int X,Y,E,a,b,c,d,e,f;<br>        while(Q–){<br>            scanf(“%d%d%d%d%d%d%d%d%d”,&amp;X,&amp;Y,&amp;E,&amp;a,&amp;b,&amp;c,&amp;d,&amp;e,&amp;f);<br>            vec.clear();<br>            int minx = X+Y-E;<br>            int maxx = X+Y+E;<br>            int miny = X-Y-E;<br>            int maxy = X-Y+E;<br>            getvec(root,minx,maxx,miny,maxy);<br>            int sz = vec.size();<br>            for(int i = 0;i &lt; sz;i++){<br>                int id = vec[i];<br>                long long tx = p[id].x;<br>                long long ty = p[id].y;<br>                p[id].x = (tx\</em>a+ty*b+(long long)(id+1)<em>c)%W;<br>                p[id].y = (tx\</em>d+ty*e+(long long)(id+1)*f)%H;<br>                p2[id].x = p[id].x+p[id].y;<br>                p2[id].y = p[id].x-p[id].y;<br>                insert(p2[id]);<br>            }<br>        }<br>        printf(“Case #%d:\n”,iCase);<br>        for(int i = 0;i &lt; N;i++)<br>            printf(“%d %d\n”,p[i].x,p[i].y);<br>    }<br>    return 0;<br>}</int></point></p>

          
        
      
    </div>

    

    
    
    
	
	<div>
		
	</div>
 
	<div>
      
	</div>

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://kuangbin.github.io/2014/09/30/uvalive6041/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="kuangbin">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/blogLogo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="kuangbin的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2014/09/30/uvalive6041/" itemprop="url">
                  UVALive 6041 - Retrenchment （KD树）
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2014-09-30 22:38:37" itemprop="dateCreated datePublished" datetime="2014-09-30T22:38:37+08:00">2014-09-30</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2018-07-29 13:43:28" itemprop="dateModified" datetime="2018-07-29T13:43:28+08:00">2018-07-29</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/KD树/" itemprop="url" rel="index"><span itemprop="name">KD树</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/KD树/Online-Judge/" itemprop="url" rel="index"><span itemprop="name">Online Judge</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/KD树/Online-Judge/UVALive/" itemprop="url" rel="index"><span itemprop="name">UVALive</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/KD树/Online-Judge/UVALive/数据结构/" itemprop="url" rel="index"><span itemprop="name">数据结构</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/KD树/Online-Judge/UVALive/数据结构/算法/" itemprop="url" rel="index"><span itemprop="name">算法</span></a></span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2014/09/30/uvalive6041/#comments" itemprop="discussionUrl">
                
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2014/09/30/uvalive6041/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><a href="https://icpcarchive.ecs.baylor.edu/index.php?option=com_onlinejudge&amp;Itemid=8&amp;page=show_problem&amp;problem=4052" target="_blank" rel="noopener">UVALive</a>   就是求最近的点和次近的点，直接用KD树搞。 中间用了一发判断点在多边形内的模板。</p>
<p>/* <strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong>***</strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong><br>Author        :kuangbin<br>Created Time  :2014/9/30 18:22:34<br>File Name     :E:\2014ACM\专题学习\KD树\UVALive6014.cpp<br>************************************************ */</p>
<p>#include &lt;stdio.h&gt;</p>
<p>#include &lt;string.h&gt;</p>
<p>#include <iostream></iostream></p>
<p>#include <algorithm></algorithm></p>
<p>#include <vector></vector></p>
<p>#include <queue></queue></p>
<p>#include <set></set></p>
<p>#include <map></map></p>
<p>#include <string></string></p>
<p>#include &lt;math.h&gt;</p>
<p>#include &lt;stdlib.h&gt;</p>
<p>#include &lt;time.h&gt;<br>using namespace std;<br>const int MAXN = 200100;<br>inline long long sqr(long long x){return x<em>x;}<br>struct Point{<br>    int x,y;<br>    Point(){}<br>    Point(int _x,int _y){<br>        x = _x;<br>        y = _y;<br>    }<br>    long long distance(const Point &amp;b)const{<br>        return sqr(x-b.x)+sqr(y-b.y);<br>    }<br>    void input(){<br>        scanf(“%d%d”,&amp;x,&amp;y);<br>    }<br>    Point operator -(const Point &amp;b)const{<br>        return Point(x-b.x,y-b.y);<br>    }<br>    long long operator ^(const Point &amp;b)const{<br>        return (long long)x\</em>b.y - (long long)y*b.x;<br>    }<br>    long long operator <em>(const Point &amp;b)const{<br>        return (long long)x\</em>b.x + (long long)y*b.y;<br>    }<br>};<br>struct Line{<br>    Point s,e;<br>    Line(){}<br>    Line(Point _s,Point _e){<br>        s = _s;<br>        e = _e;<br>    }<br>    bool pointonseg(Point p){<br>        return ((p-s)^(e-s)) == 0 &amp;&amp; ((p-s)<em>(p-e)) &lt;= 0;<br>    }<br>};<br>struct polygon{<br>    int n;<br>    Point p[100];<br>    Line l[100];<br>    void input(int _n){<br>        n = _n;<br>        for(int i = 0;i &lt; n;i++)<br>            p[i].input();<br>    }<br>    void getline(){<br>        for(int i = 0;i &lt; n;i++)<br>            l[i] = Line(p[i],p[(i+1)%n]);<br>    }<br>    //2边上<br>    //1内部<br>    //0外部<br>    int relationpoint(Point q){<br>        getline();<br>        for(int i = 0;i &lt; n;i++)<br>            if(l[i].pointonseg(q))<br>                return 2;<br>        int cnt = 0;<br>        for(int i = 0;i &lt; n;i++){<br>            int j = (i+1)%n;<br>            long long k = (q-p[j])^(p[i]-p[j]);<br>            int u = p[i].y - q.y;<br>            int v = p[j].y - q.y;<br>            if(k &gt; 0 &amp;&amp; u &lt; 0 &amp;&amp; v &gt;= 0)cnt++;<br>            if(k &lt; 0 &amp;&amp; v &lt; 0 &amp;&amp; u &gt;= 0)cnt–;<br>        }<br>        return cnt != 0;<br>    }<br>}po;<br>namespace KDTree{<br>    struct Point {<br>        int x,y;<br>        int index;<br>        long long distance(const Point &amp;b)const{<br>            return sqr(x-b.x) + sqr(y-b.y);<br>        }<br>    };<br>    struct qnode{<br>        Point p;<br>        long long dis;<br>        qnode(){}<br>        qnode(Point _p,long long _dis){<br>            p = _p;<br>            dis = _dis;<br>        }<br>        bool operator &lt;(const qnode &amp;b)const{<br>            if(dis != b.dis)return dis &lt; b.dis;<br>            else return p.index &lt; b.p.index;<br>        }<br>    };<br>    priority_queue<qnode>q;<br>    inline bool cmpX(const Point &amp;a,const Point &amp;b){<br>        return a.x &lt; b.x || (a.x == b.x &amp;&amp; a.y &lt; b.y) || (a.x == b.x &amp;&amp; a.y == b.y &amp;&amp; a.index &lt; b.index);<br>    }<br>    inline bool cmpY(const Point &amp;a,const Point &amp;b){<br>        return a.y &lt; b.y || (a.y == b.y &amp;&amp; a.x &lt; b.x) || (a.y == b.y &amp;&amp; a.x == b.x &amp;&amp; a.index &lt; b.index);<br>    }<br>    bool cmp(const Point &amp;a,const Point &amp;b,bool div){<br>        return div?cmpY(a,b):cmpX(a,b);<br>    }<br>    struct Node{<br>        Point e;<br>        Node \</qnode></em>lc,*rc;<br>        bool div;<br>    }pool[MAXN],*tail,*root;<br>    void init(){<br>        tail = pool;<br>    }<br>    Node *build(Point *a,int l,int r,bool div){<br>        if(l &gt;= r)return NULL;<br>        Node <em>p = tail++;<br>        p-&gt;div = div;<br>        int mid = (l+r)/2;<br>        nth_element(a+l,a+mid,a+r,div?cmpY:cmpX);<br>        p-&gt;e = a[mid];<br>        p-&gt;lc = build(a,l,mid,!div);<br>        p-&gt;rc = build(a,mid+1,r,!div);<br>        return p;<br>    }<br>    void search(Point p,Node </em>x,bool div,int m){<br>        if(!x)return;<br>        if(cmp(p,x-&gt;e,div)){<br>            search(p,x-&gt;lc,!div,m);<br>            if(q.size() &lt; m){<br>                q.push(qnode(x-&gt;e,p.distance(x-&gt;e)));<br>                search(p,x-&gt;rc,!div,m);<br>            }<br>            else {<br>                if(p.distance(x-&gt;e) &lt;= q.top().dis){<br>                    q.push(qnode(x-&gt;e,p.distance(x-&gt;e)));<br>                    q.pop();<br>                }<br>                if(!div){<br>                    if(sqr(x-&gt;e.x-p.x) &lt;= q.top().dis)<br>                        search(p,x-&gt;rc,!div,m);<br>                }<br>                else {<br>                    if(sqr(x-&gt;e.y-p.y) &lt;= q.top().dis)<br>                        search(p,x-&gt;rc,!div,m);<br>                }<br>            }<br>        }<br>        else {<br>            search(p,x-&gt;rc,!div,m);<br>            if(q.size() &lt; m){<br>                q.push(qnode(x-&gt;e,p.distance(x-&gt;e)));<br>                search(p,x-&gt;lc,!div,m);<br>            }<br>            else {<br>                if(p.distance(x-&gt;e) &lt;= q.top().dis){<br>                    q.push(qnode(x-&gt;e,p.distance(x-&gt;e)));<br>                    q.pop();<br>                }<br>                if(!div){<br>                    if(sqr(x-&gt;e.x-p.x) &lt;= q.top().dis)<br>                        search(p,x-&gt;lc,!div,m);<br>                }<br>                else {<br>                    if(sqr(x-&gt;e.y-p.y) &lt;= q.top().dis)<br>                        search(p,x-&gt;lc,!div,m);<br>                }<br>            }<br>        }<br>    }<br>    void search(Point p,int m){<br>        while(!q.empty())q.pop();<br>        search(p,root,0,m);<br>    }<br>};<br>Point p[MAXN];<br>KDTree::Point pp[MAXN];</p>
<p>int main()<br>{<br>    int T;<br>    scanf(“%d”,&amp;T);<br>    int iCase = 0;<br>    while(T–){<br>        iCase++;<br>        int n;<br>        scanf(“%d”,&amp;n);<br>        for(int i = 0;i &lt; n;i++)p[i].input();<br>        int R;<br>        printf(“Case #%d:\n”,iCase);<br>        scanf(“%d”,&amp;R);<br>        for(int r = 1; r &lt;= R;r++){<br>            printf(“Region %d\n”,r);<br>            int bb;<br>            scanf(“%d”,&amp;bb);<br>            po.input(bb);<br>            int cnt = 0;<br>            for(int i = 0;i &lt; n;i++){<br>                if(po.relationpoint(p[i]) &gt; 0){<br>                    pp[cnt].x = p[i].x;<br>                    pp[cnt].y = p[i].y;<br>                    pp[cnt].index = i;<br>                    cnt++;<br>                }<br>            }<br>            KDTree::init();<br>            KDTree::root = KDTree::build(pp,0,cnt,0);<br>            KDTree::Point o;<br>            int m;<br>            scanf(“%d”,&amp;m);<br>            while(m–){<br>                scanf(“%d%d”,&amp;o.x,&amp;o.y);<br>                KDTree::search(o,2);<br>                if(KDTree::q.size() != 2)while(1);<br>                KDTree::Point p2 = KDTree::q.top().p;<br>                KDTree::q.pop();<br>                KDTree::Point p1 = KDTree::q.top().p;<br>                KDTree::q.pop();<br>                printf(“%d %d\n”,p1.index+1,p2.index+1);<br>            }<br>        }<br>    }<br>    return 0;<br>}</p>

          
        
      
    </div>

    

    
    
    
	
	<div>
		
	</div>
 
	<div>
      
	</div>

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/5/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><span class="page-number current">6</span><a class="page-number" href="/page/7/">7</a><span class="space">&hellip;</span><a class="page-number" href="/page/13/">13</a><a class="extend next" rel="next" href="/page/7/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/blogLogo.jpg"
                alt="kuangbin" />
            
              <p class="site-author-name" itemprop="name">kuangbin</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">128</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">150</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">53</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  <a href="https://github.com/kuangbin" target="_blank" title="GitHub"><i class="fa fa-fw fa-github"></i>GitHub</a>
                  
                </span>
              
                <span class="links-of-author-item">
                  <a href="https://www.linkedin.com/in/kuangbin/" target="_blank" title="Linkedin"><i class="fa fa-fw fa-globe"></i>Linkedin</a>
                  
                </span>
              
                <span class="links-of-author-item">
                  <a href="mailto:kuangbin2009@126.com" target="_blank" title="E-Mail"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  
                </span>
              
                <span class="links-of-author-item">
                  <a href="https://www.zhihu.com/people/kuang-bin-95" target="_blank" title="zhihu"><i class="fa fa-fw fa-globe"></i>zhihu</a>
                  
                </span>
              
                <span class="links-of-author-item">
                  <a href="http://www.cnblogs.com/kuangbin/" target="_blank" title="cnblogs"><i class="fa fa-fw fa-globe"></i>cnblogs</a>
                  
                </span>
              
                <span class="links-of-author-item">
                  <a href="http://wpa.qq.com/msgrd?v=3&uin=1691626124&site=qq&menu=yes" target="_blank" title="QQ"><i class="fa fa-fw fa-globe"></i>QQ</a>
                  
                </span>
              
            </div>
          

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-block">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-友情链接"></i>
                Links
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="http://www.cnblogs.com/kuangbin/" title="我的博客园" target="_blank">我的博客园</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://zhiyi.live/" title="MoonChasing" target="_blank">MoonChasing</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://taowusheng.cn/" title="YIFEI" target="_blank">YIFEI</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://fancypei.github.io/" title="Fancy" target="_blank">Fancy</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://vincentxwd.github.io/" title="Kirai" target="_blank">Kirai</a>
                  </li>
                
              </ul>
            </div>
          

          
            
          
          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love" id="animate">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">kuangbin</span>

  

  
</div>




  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动 v3.7.1</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://theme-next.org">NexT.Pisces</a> v6.3.0</div>




        
<div class="busuanzi-count">
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv" title="总访客量">
      <i class="fa fa-user"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
    </span>
  

  
    <span class="site-pv" title="总访问量">
      <i class="fa fa-eye"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
    </span>
  
</div>









        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

    
	
    

    
      <div>
        <!-- Go to www.addthis.com/dashboard to customize your tools -->
<div class="addthis_inline_share_toolbox">
  <script type = "text/javascript" src = "//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5b6455de9c11f26c" async = "async" ></script>
</div>

      </div>
    
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>












  















  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.3.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.3.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=6.3.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=6.3.0"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.3.0"></script>



  

  
    <script id="dsq-count-scr" src="https://kuangbin-github-io.disqus.com/count.js" async></script>
  

  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  

  
  

  

  

  

  

  

  <script type="text/javascript" src="/lib/clipboard/clipboard.min.js"></script>
<script type="text/javascript" src="/js/src/custom.js"></script>
</body>
</html>
